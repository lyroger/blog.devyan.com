
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>罗琰的技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="luoyan">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="罗琰的技术博客">
<meta property="og:url" content="http://lyroger.github.io/index.html">
<meta property="og:site_name" content="罗琰的技术博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="罗琰的技术博客">

    
    <link rel="alternative" href="http://lyroger.github.io/atom.xml" title="罗琰的技术博客" type="application/atom+xml">
    
    
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="罗琰的技术博客">罗琰的技术博客</a></h1>
				<h2 class="blog-motto">积累与分享成长的技术经验</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:lyroger.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/30/hello-world/" title="Hello World" itemprop="url">Hello World</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-08-30T07:23:52.000Z" itemprop="datePublished"> 发表于 2016-08-30</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/08/30/hello-world/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/08/30/hello-world/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/25/Jenkins+Git自动构建/" title="Jenkins+Git自动构建" itemprop="url">Jenkins+Git自动构建</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-08-25T09:52:00.000Z" itemprop="datePublished"> 发表于 2016-08-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>   想想以前，发给测试的测试包都是通过手动使用XCode来打包，如果项目工程比较大，Archive过程时间还是比较长的，打多了觉得特没劲，非常浪费时间，特别是使用了敏捷开发流程的，要是还用手动打包，估计你在打包上耗得时间都够你解决几个bug了。敏捷开发也是强调使用自动化的，所以也少不了自动构建的环节，那么接下来说说如何使用Jenkins+Git来自动构建我们的项目，从而方便测试，也让开发有更多的经历投入到编码和业务中而不是浪费在这些无用的流程中。</p>
<h2 id="一-Jenkins安装"><a href="#一-Jenkins安装" class="headerlink" title="一.Jenkins安装"></a>一.Jenkins安装</h2><p>1.下载最新的版本（一个 WAR 文件）。<a href="http://Jenkins-ci.org/" target="_blank" rel="external">Jenkins官方网址</a><br>2.运行 Java -jar jenkins.war 。<br>如果你的java环节低于java7 它会提示你升级java环节，你可以到<a href="https://www.java.com/en/download/" target="_blank" rel="external">这里下载</a>，安装最新的java环境。<br>如果一切顺利，那么只要在你本机浏览器中输入<a href="http://127.0.0.1:8080" target="_blank" rel="external">127.0.0.1:8080</a>即可看到Jenkins的主页面。<br><img src="/images/jenins首页.png" alt=""></p>
<h2 id="二-Jenkins配置"><a href="#二-Jenkins配置" class="headerlink" title="二.Jenkins配置"></a>二.Jenkins配置</h2><p>1.先新建一个项目。<br><img src="/images/创建项目.png" alt=""><br>2.输入项目名称和构建风格。<br><img src="/images/创建项目1.png" alt=""><br>3.项目配置</p>
<p><img src="/images/配置项目-项目名称.png" alt=""><br>4.源码管理</p>
<p><img src="/images/项目配置-源码管理.png" alt=""><br>这一步输入你项目在Git上的仓库地址，这里的授权有两种形式，一种是使用http登录，一种是使用ssh授权；<br>*如果使用http授权的看下图：</p>
<p><img src="/images/项目配置-源码管理添加http授权.png" alt=""><br>这里输入你git上的登录名和密码。<br>*如果使用SSH授权看下图：</p>
<p><img src="/images/项目配置-源码管理SSH授权创建.png" alt=""><br>kind要选择SSH Username with private key,Username可以随便输入，一个描述而已，Private Key选Enter directly，然后在Key中输入你在Git上的秘钥，这个秘钥的制作在我前面的<a href="http://roger.farbox.com/post/macshang-zhi-zuo-sshmi-yao" target="_blank" rel="external">博客</a>中有提到，这里就不多说了。最后点击Add，SSH的授权就制作OK了。<br>5.构建<br>源码可以下载了，那么接下来就是如何去生成一个ipa包了，我们通过构建的方式来实现，接下来我们来配置一下构建流程，构建的方式很多中，这里讲讲比较简单的一种，使用shell来实现。</p>
<p><img src="/images/构建1.png" alt=""></p>
<p><img src="/images/项目配置-构建配置.png" alt=""><br>编写脚本，这个脚本支持的是workspace的，如果没有使用workspace的，问题不大，稍作修改即可。脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">cd $WORKSPACE</div><div class="line">SDK_VERSION=&quot;iphoneos8.3&quot;</div><div class="line"></div><div class="line">PROJECT_NAME=&quot;JenkinsDemo&quot;</div><div class="line">PROVISION_UUID=&quot;你的描述文件的UUID，可以通过在XCode选中描述文件ctr+c的方法获取到&quot;</div><div class="line">PROVISONING_PROFILE=&quot;JenkinsDemo_Distribution&quot;</div><div class="line"></div><div class="line">XCODE_PRJ=&quot;xcodeproj&quot;</div><div class="line">FILE_EXTENSION=&apos;xcworkspace&apos;</div><div class="line">PROJECT_DIR=`pwd`</div><div class="line">CD_XCODE_PRJ=`pwd`/$PROJECT_NAME.$XCODE_PRJ</div><div class="line">PROJECT_WORKSPACE=$PROJECT_DIR.</div><div class="line">PROJECT_BUILD=`pwd`/$PROJECT_NAME/BUILD</div><div class="line"></div><div class="line">APP_PATH=&quot;build/Release-iphoneos/$&#123;PROJECT_NAME&#125;.app&quot;</div><div class="line">TARGET_APP_PATH=&quot;build/Release-iphoneos/$&#123;PROJECT_NAME&#125;.ipa&quot;</div><div class="line">ARCHIVEPATH=&quot;build/Release-iphoneos/$&#123;PROJECT_NAME&#125;.xcarchive&quot;</div><div class="line"></div><div class="line">cd &quot;$PROJECT_DIR&quot;</div><div class="line"></div><div class="line">cd ..</div><div class="line">cd &quot;$CD_XCODE_PRJ&quot;</div><div class="line">sed -i &apos;&apos; &quot;s/\(PROVISIONING_PROFILE.=.\&quot;\).*\(\&quot;\)/\1$PROVISION_UUID\2/g&quot; project.pbxproj</div><div class="line">cd ..</div><div class="line">rm -rf build</div><div class="line">xcodebuild -workspace $PROJECT_DIR/$PROJECT_NAME.$FILE_EXTENSION -scheme $PROJECT_NAME -destination generic/platform=iOS archive -archivePath $ARCHIVEPATH</div><div class="line">xcodebuild -exportArchive -exportFormat IPA -archivePath $ARCHIVEPATH -exportPath $TARGET_APP_PATH -exportProvisioningProfile &quot;$&#123;PROVISONING_PROFILE&#125;&quot;</div><div class="line">curl -F &quot;file=@build/Release-iphoneos/JenkinsDemo.ipa&quot; -F &quot;uKey=蒲公英上的uKey&quot; -F &quot;_api_key=蒲公英上的apikey&quot; https://www.pgyer.com/apiv1/app/upload</div></pre></td></tr></table></figure></p>
<p>*构建成功后这里可能会出现一个问题，你的项目工程中的配置需要设置一下shared，不然构建的会一直报错。找不到工程文件，如下图设置：</p>
<p><img src="/images/工程配置.png" alt=""><br>*OK，保存构建后，接下来就可以回到项目管理页面了。</p>
<p><img src="/images/项目管理-立即构建.png" alt=""><br><em>一般构建在一分钟左右，先下载源代码，然后打包，最后将ipa包上传到蒲公英平台。
</em>可以看出，构建后蓝色的表示构建成功，红色和灰色表示构建失败，可以点击相应的图标，查看构建日志。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/08/25/Jenkins+Git自动构建/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/08/25/Jenkins+Git自动构建/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/18/swift实战/" title="swift实战" itemprop="url">swift实战</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-07-18T03:26:00.000Z" itemprop="datePublished"> 发表于 2016-07-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="OC调用swift方式"><a href="#OC调用swift方式" class="headerlink" title="OC调用swift方式"></a>OC调用swift方式</h2><p>在OC代码中引入头文件 #import “项目名称-swift.h”<br>即可用OC语法调用swift写的代码了。</p>
<h2 id="swift中如何写Block"><a href="#swift中如何写Block" class="headerlink" title="swift中如何写Block"></a>swift中如何写Block</h2><p>在swift中定义一个闭包的关键词为 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">在A类中定义一个闭包</div><div class="line">``` swift</div><div class="line">//定义一个闭包</div><div class="line">typealias LoginSuceesedBlock = (successed:Bool)-&gt;Void</div><div class="line">class LoginViewController:UIViewController&#123;</div><div class="line">    //将函数指针赋值给loginActionBlock闭包</div><div class="line">    func initWithBlock(closure:LoginSuceesedBlock?)&#123;</div><div class="line">        loginActionBlock = closure</div><div class="line">    &#125;</div><div class="line">    private func loginAction(sender:AnyObject?) &#123;</div><div class="line">        let loginSuccessed:Bool = loginViewModel.loginRequestAction(textUserName.text!,passWord: textPwd.text!)</div><div class="line">        if loginSuccessed &#123;</div><div class="line">            //block 回调</div><div class="line">            if (loginActionBlock != nil) &#123;</div><div class="line">                self.loginActionBlock!(successed: true)</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            let alert:UIAlertView =  UIAlertView()</div><div class="line">            alert.title = &quot;提示&quot;</div><div class="line">            alert.message = &quot;登录失败&quot;</div><div class="line">            alert.addButtonWithTitle(&quot;OK&quot;)</div><div class="line">            alert.show()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在B类中传一个函数到A类<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">authorizeOperation</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> loginVC = <span class="type">LoginViewController</span>()</div><div class="line">        loginVC.initWithBlock(loginActionSuccessed)</div><div class="line">        <span class="keyword">self</span>.navigationController?.pushViewController(loginVC, animated: <span class="literal">true</span>)</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginActionSuccessed</span><span class="params">(successed:Bool)</span></span> -&gt; <span class="type">Void</span> &#123;</div><div class="line">        <span class="keyword">if</span> successed &#123;</div><div class="line">            <span class="comment">//todo loginSuccessed something</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/07/18/swift实战/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/07/18/swift实战/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/08/MVVM模式的学习/" title="MVVM模式的学习" itemprop="url">MVVM模式的学习</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-07-08T03:15:00.000Z" itemprop="datePublished"> 发表于 2016-07-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>##一 前言<br>这里就不多说为什么要学习MVVM模式了，新东西当然需要有一颗进步的心态去接纳它，不管他是否真的能在实际开发中帮到你，我想至少会在某种场景中用到。好吧，我们先来理解一下什么是MVVM模式吧。</p>
<p>##MVVM的理解<br>MVVM这种模式其实是来自<a href="https://msdn.microsoft.com/en-us/library/hh848246.aspx" target="_blank" rel="external">微软</a>的，我们用一张视图来概括一下MVVM吧</p>
<p><img src="/images/mvvm.png" alt=""><br>从这个图可以看出，view和View Controller都归纳为View，即V，视图相关的业务逻辑以后就写到这里了，中间的ViewModel用来写MVC中Controller的一部分逻辑，比如网络请求的业务逻辑，视图展示数据的业务逻辑等等，这样以前的Controller的业务逻辑代码岂不是变少了很多，在实际使用当中，Controller的代码也变得非常清晰，因为你只会关注业务逻辑，而不会去关注这些数据怎么来的，怎么组装的等等这些细节了。Model还是以前MVC中的model没有什么变化，然而这三个层级的关系又是如何的呢？View只引用ViewModel，View通过Action来改变ViewModel，ViewMode的业务来更新View，注意ViewModel不要去引用View，ViewModel只是写了一些组装数据的业务逻辑而已，把控好各个层级的关系可以把你的项目写的很清晰。ViewMode中引用Model，ViewModel的网络请求，数据组装等等业务逻辑的结果都保存到了Model中，Model一旦有更新会通知ViewModel，一旦View有需求更新或ViewModel变更需要通知View，这个时候就可以去更新View了。如果理解的简单点，应该就是一个双向绑定的关系，View跟ViewModel绑定，一旦ViewModel有变更，View更新；ViewModel更Model绑定，一旦Model有变更，则会通知ViewModel，继而会更新View。</p>
<p>##MVVM与MVC的对比<br>MVVM较MVC的好处个人觉得最重要的应该是将臃肿的Controller解放了，有一大部分业务逻辑分解到了ViewModel中来了；其次应该就是做单元测试比较方便。因为很多业务逻辑已经抽象出成单独的方法，很容易做单元测试。当然个人也有一些用MVVM比较麻烦的地方，在一些较简单的Controller中，写MVVM模式，确实又有点累赘，增加了一些代码量。但总体来说，MVVM确实把代码的复杂度降下来了。</p>
<p>##推荐<br>说到最后，有一个推荐的框架比较适合MVVM，也是最近在学习的一个框架<a href="http://roger.farbox.com/post/reactivecocoaxue-xi" target="_blank" rel="external">ReactiveCocoa</a></p>
<p>##最后<br>写了这些都是自己的个人理解，还并未去实际，若有理解出入，还望谅解。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/07/08/MVVM模式的学习/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/07/08/MVVM模式的学习/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/07/Mac上制作SSH秘钥/" title="Mac上制作SSH秘钥" itemprop="url">Mac上制作SSH秘钥</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-07-07T09:16:00.000Z" itemprop="datePublished"> 发表于 2016-07-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>打开终端，$ ssh-keygen 一路enter下。<br>生成  在当前用户名下 会有一个.sh文件。<br>查看 .ssh<br>$ ls -a ~/.ssh  通过搜索目录<br>id_rsa<br>id_rsa.pub<br>打开  id_rsa.pub文件 里面就有需要的ssh key。<br>或者使用文本编辑工具打开该文件，命令是：<br>vim ~/.ssh/id_rsa.pub</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/07/07/Mac上制作SSH秘钥/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/07/07/Mac上制作SSH秘钥/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/06/ReactiveCocoa学习/" title="ReactiveCocoa学习" itemprop="url">ReactiveCocoa学习</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-07-06T01:39:00.000Z" itemprop="datePublished"> 发表于 2016-07-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>##一、signal的释放问题<br>当signal作为local变量时，如果没有被subscribe，那么方法执行完后，该变量会被dealloc。但如果signal有被subscribe，那么subscriber会持有该signal，直到signal sendCompleted或sendError时，才会解除持有关系，signal才会被dealloc。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/07/06/ReactiveCocoa学习/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/07/06/ReactiveCocoa学习/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/25/iOS基础深究/" title="iOS基础深究" itemprop="url">iOS基础深究</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-02-25T01:37:00.000Z" itemprop="datePublished"> 发表于 2016-02-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="一、assign与weak的区别"><a href="#一、assign与weak的区别" class="headerlink" title="一、assign与weak的区别"></a>一、assign与weak的区别</h2><p>assign适用于基本数据类型，weak是适用于NSObject对象，并且是一个弱引用。<br>assign其实也可以用来修饰对象，那么我们为什么不用它呢？因为被assign修饰的对象在释放之后，指针的地址还是存在的，也就是说指针并没有被置为nil。如果在后续的内存分配中，刚好分到了这块地址，程序就会崩溃掉。<br>而weak修饰的对象在释放之后，指针地址会被置为nil。所以现在一般弱引用就是用weak。<br>所以在使用assign修饰对象，就有可能会导致程序EXC_BAD_ACCESS异常，也就是所谓的野指针错误！</p>
<h2 id="二、nonatomic与atomic"><a href="#二、nonatomic与atomic" class="headerlink" title="二、nonatomic与atomic"></a>二、nonatomic与atomic</h2><p>nonatomic: 非原子性访问，对属性赋值的时候不加锁，多线程并发访问会提高性能。若不加此属性，则默认是两个访问方法都为原子型事务访问。<br>atomic:是Objc使用的一种线程保护技术，基本上来讲，是防止在写未完成的时候被另外一个线程读取，造成数据错误。而这种机制是耗费系统资源的，所以在iPhone这种小型设备上，如果没有使用多线程间的通讯编程，那么nonatomic是一个非常好的选择。</p>
<h2 id="三、ARC模式下重写set方法"><a href="#三、ARC模式下重写set方法" class="headerlink" title="三、ARC模式下重写set方法"></a>三、ARC模式下重写set方法</h2><p>网上很多人说直接赋值就OK了，我感觉不太妥，这里我验证了下，如果是strong修饰的属性，是可以直接赋值的，如果是copy，那么需要copy一份了。看看下面代码<br>1.首先定义两个copy属性及测试方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic,copy) NSString *test;</div><div class="line">@property (nonatomic,copy) NSMutableString *testMutableString;</div><div class="line">......</div><div class="line">//测试方法</div><div class="line">- (void)testProperty</div><div class="line">&#123;</div><div class="line">    NSString *testString = @&quot;test&quot;;</div><div class="line">    NSMutableString *testMutableString = [NSMutableString stringWithFormat:@&quot;testMutableString&quot;];</div><div class="line">    self.test = testString;</div><div class="line">    self.testMutableString = testMutableString;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.重写两个属性的set方法，验证直接赋值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)setTest:(NSString *)test</div><div class="line">&#123;</div><div class="line">    _test = test;</div><div class="line">    NSLog(@&quot;_test = %p,test = %p&quot;,_test,test);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setTestMutableString:(NSMutableString *)testMutableString</div><div class="line">&#123;</div><div class="line">    _testMutableString = testMutableString;</div><div class="line">    NSLog(@&quot;_testMutableString = %p,testMutableString = %p&quot;,_testMutableString,testMutableString);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>打印出来的日志显示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-02-25 10:23:30.618 DemoList[4341:2473539] _test = 0x1001364d0,test = 0x1001364d0</div><div class="line">2016-02-25 10:23:30.621 DemoList[4341:2473539] _testMutableString = 0x13ef2b950,testMutableString = 0x13ef2b950</div></pre></td></tr></table></figure></p>
<p>直接赋值的方式从这里可以看出来，打印的地址都是一样的，只是引用而已，并没有产生新的对象。<br>3.我们再来看看copy一份的结果。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)setTest:(NSString *)test</div><div class="line">&#123;</div><div class="line">    _test = [test copy];</div><div class="line">    NSLog(@&quot;_test = %p,test = %p&quot;,_test,test);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setTestMutableString:(NSMutableString *)testMutableString</div><div class="line">&#123;</div><div class="line">    _testMutableString = [testMutableString copy];</div><div class="line">    NSLog(@&quot;_testMutableString = %p,testMutableString = %p&quot;,_testMutableString,testMutableString);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>//打印出来的日志显示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-02-25 10:12:26.642 DemoList[4332:2471119] _test = 0x10018a4d0,test = 0x10018a4d0</div><div class="line">2016-02-25 10:12:26.645 DemoList[4332:2471119] _testMutableString = 0x15d76b6d0,testMutableString = 0x15d6abd40</div></pre></td></tr></table></figure></p>
<p>这个时候你会发现，NSString的属性地址还是一样的，NSMutabeString的属性地址不一样了，这样就对了，NSString的属性其实希望的就是引用一份，而可变字符的就是希望真正的copy一份，如果地址还一样，那么就没必要使用可变的对象了。<br>总结下ARC模式的set方法，使用copy修饰属性时，最好使用copy去赋值。其他的可以直接赋值就是了。</p>
<h2 id="四、block属性为什么需要使用copy修饰"><a href="#四、block属性为什么需要使用copy修饰" class="headerlink" title="四、block属性为什么需要使用copy修饰"></a>四、block属性为什么需要使用copy修饰</h2><p>因为block变量默认是声明为栈变量的，为了能够在block的声明域外使用，所以要把block拷贝（copy）到堆，所以说为了block属性声明和实际的操作一致，最好声明为copy。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/02/25/iOS基础深究/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/02/25/iOS基础深究/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/24/关于字符串的分割/" title="关于字符串的分割" itemprop="url">关于字符串的分割</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-02-24T02:47:00.000Z" itemprop="datePublished"> 发表于 2016-02-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>今天在字符串分割上遇到一个坑，一不小心便踩了，问题是这样的：我接收到服务端传过来的一个包含多个图片地址的字符串，使用“,”分割，我使用<code>componentsSeparatedByString:</code>来分割，将多个图片地址存入数组，并根据数组的个数来加载默认图片，等图片下载完成后替换对应的默认图片。现在服务端给我返回了一个@””字符串，我的代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSArray *descImages = [descImage componentsSeparatedByString:@&quot;,&quot;];</div></pre></td></tr></table></figure></p>
<p>其实这个时候descImage等于””，但使用<code>componentsSeparatedByString:</code>分割返回的数组是有一个对象的，就是一个空字符串，这个可能我并没想到，导致服务端返回空字符串时，我这边也多加载了一个图片，这个图片还一直下载不下来。这个也让我明白：<code>componentsSeparatedByString:</code>的意思，有分割字符就根据字符分割返回数组，没分割字符则返回被分割的字符串，@””也是一个字符串，它也是有内存地址的，跟nil并不一样。看看下面的代码就明白了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)testComponentSeparatedByString</div><div class="line">&#123;</div><div class="line">    NSString *descImage = @&quot;&quot;;</div><div class="line">    NSArray *descImages = [descImage componentsSeparatedByString:@&quot;,&quot;];</div><div class="line">    NSLog(@&quot;descImages = %@,descImages.count=%zd,descImage = %p,nil= %p&quot;,descImages,descImages.count,descImage,nil);</div><div class="line">&#125;</div><div class="line">打印出来的</div><div class="line">descImages = (</div><div class="line">    &quot;&quot;</div><div class="line">),descImages.count=1,descImage = 0x1001d5690,nil= 0x0</div></pre></td></tr></table></figure></p>
<p>因此要解决这个问题就得加一个判断给descImage.length&gt;0即可。</p>
<h3 id="衍生学习"><a href="#衍生学习" class="headerlink" title="衍生学习"></a>衍生学习</h3><p>componentsSeparatedByCharactersInSet的使用，使用多个字符分割字符串：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NSString *str = @&quot;A~B^C&quot;;</div><div class="line">NSArray *arr = [str componentsSeparatedByCharactersInSet:[NSCharacterSet characterSetWithCharactersInString:@&quot;^~&quot;]];</div><div class="line">NSLog(@&quot;%@&quot;, arr);</div><div class="line">打印出来</div><div class="line">(</div><div class="line">    A,</div><div class="line">    B,</div><div class="line">    C</div><div class="line">)</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/02/24/关于字符串的分割/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/02/24/关于字符串的分割/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/21/线上APP使用动态库添加需求方式/" title="动态添加需求(动态库)" itemprop="url">动态添加需求(动态库)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-01-21T06:26:00.000Z" itemprop="datePublished"> 发表于 2016-01-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前些天，公司提出需要动态添加一些需求给线上App，当时觉得有点不太好办，因为当时还没有头绪，后来上网查了些资料，如<a href="http://blog.csdn.net/like7xiaoben/article/details/44081257" target="_blank" rel="external">这篇文章</a>，不过他这只是将写好的动态库拷贝到本地的沙盒中，也就是有这个方法然后我有了头绪，我只需将写好的动态库压缩上传到服务器，提供线上APP下载，解压后加载动态库执行代码即可实现其功能。接下来还是来看看具体操作和过程中遇到的一些问题和注意点吧。整个需求我写了一个<a href="https://github.com/lyroger/DynamicDemo" target="_blank" rel="external">demo</a>,你可以先下载这个<a href="https://github.com/lyroger/DynamicDemo" target="_blank" rel="external">demo</a>,对照此文章来理解。</p>
<h3 id="一、生成动态库"><a href="#一、生成动态库" class="headerlink" title="一、生成动态库"></a>一、生成动态库</h3><p>Xcode6就支持动态库了，所以只要使用XCode6及更高版本的XCode便可以生成动态库。<br><img src="/images/9E729546-8D22-48A6-A3D7-88FBDD787DD9.png" alt=""><br>此demo中满足需求的动态库我取名叫DynamicFramework.framework。在这个动态库中我实现了弹出一个UIViewController和在这个UIViewController中加载了动态库中的资源文件。并在这个动态库中引用了其他的动态库（此的demo中引用的是CommonFramework.framework），并调用其他库中的方法。这样就可以满足灵活调用和灵活添加需求的要求了。如果你需要给线上app提供动态库，你可以将写好的动态库压缩上传到服务器提供下载。</p>
<h3 id="二、加载动态库"><a href="#二、加载动态库" class="headerlink" title="二、加载动态库"></a>二、加载动态库</h3><p>在主工程中我们来加载写好的动态库，从网络下载的过程我在demo就没实现了，只做了将下下来的zip文件解压的操作，加载动态库步骤很简单，先将服务器上的DynamicFramework.framework.zip文件下载到沙盒的document中（当然，如果只是写Demo，你完全可以手动拷贝到document中），找到该zip文件，解压到同一个目录下，然后将动态库复制到程序中，即可使用，具体代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">- (void)loadDynamicFrameworkModel</div><div class="line">&#123;</div><div class="line">    NSArray* paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES);</div><div class="line">    NSString *documentDirectory = nil;</div><div class="line">    if ([paths count] != 0)</div><div class="line">        documentDirectory = [paths objectAtIndex:0];</div><div class="line">    </div><div class="line">    //本地动态库文件</div><div class="line">    NSString *libName = @&quot;DynamicFramework.framework&quot;;</div><div class="line">    NSString *destLibPath = [documentDirectory stringByAppendingPathComponent:libName];</div><div class="line">    </div><div class="line">    //第一步，判断是否存在动态库文件</div><div class="line">    NSFileManager *manager = [NSFileManager defaultManager];</div><div class="line">    if (![manager fileExistsAtPath:destLibPath]) &#123;</div><div class="line">        NSLog(@&quot;没有动态库文件&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    //第三步，复制到程序中</div><div class="line">    NSBundle *frameworkBundle = [NSBundle bundleWithPath:destLibPath];</div><div class="line">    if (frameworkBundle &amp;&amp; [frameworkBundle load]) &#123;</div><div class="line">        NSLog(@&quot;load Bundle success&quot;);</div><div class="line">    &#125; else &#123;</div><div class="line">        NSLog(@&quot;load Bundle failed&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意:如果出问题了，是不是跟如下类似的错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error loading ...... no suitable image found.  Did find: ...</div></pre></td></tr></table></figure></p>
<p>其实这个错误就是我当初最当心的问题，这个就是由于写动态库时打包的签名和主工程打包的签名不一致导致主工程加载下载下来的动态库失败产生的错误。解决这个错误的办法就是保证你后续写的动态库打包时签名一定要跟线上发布的APP签名一致，否则App并不会执行你的动态库。</p>
<h3 id="三、调用动态库"><a href="#三、调用动态库" class="headerlink" title="三、调用动态库"></a>三、调用动态库</h3><p>将动态库加载到程序中后，接下来就是调用动态库中的代码了。<br>1.首先我们用运行时来加载动态库中的类，窥探是否有该类，以防使用报错奔溃。<br>2.如果有动态库入口的方法类，我们则使用NSObject类 “- (id)performSelector:(SEL)aSelector withObject:(id)object1 withObject:(id)object2”来执行。<br>这一步我们可以将主工程中的一些变量传入动态库中，供动态库使用，完成新需求。特别是资源信息，以下将frameworkBundle信息传入动态库中供期获取资源。<br>调用代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//第四步，获取动态库中入口类</div><div class="line">Class pacteraClass = NSClassFromString(@&quot;DynamaicEnterance&quot;);</div><div class="line">if (!pacteraClass) &#123;</div><div class="line">    NSLog(@&quot;Unable to get DynamicFramework class&quot;);</div><div class="line">    return;</div><div class="line">&#125;</div><div class="line">//第五步，执行动态库中入口类的方法</div><div class="line">NSObject *pacteraObject = [pacteraClass new];</div><div class="line">[pacteraObject performSelector:@selector(showViewOnController:withBundle:) withObject:self withObject:frameworkBundle];</div></pre></td></tr></table></figure></p>
<p>动态库中DynamaicEnterance类只要实现showViewOnController:withBundle:方法就可以了。<br>在此方法中你可以做你想做的事情，这个桥接过程就已经完成了。此demo中就实现弹出一个UIViewcontroller并加载动态库中的图片资源和调用其他库中的函数。</p>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>总而言之，自从苹果支持动态库后，确实方便了许多。</p>
<ol>
<li>如果你跟我的需求一致，使用方式一致，请一定记住，你的动态库的签名需跟你的主App的签名一致，否则你的动态库将无法加载到主工程中，你的代码也将无法执行。</li>
<li>生成动态库只在iOS8及更高版本支持，但并不影响低版本使用。</li>
<li>使用动态库实现动态新增需求我并没有在线上APP中实现过，只实现与自己写的Demo。理论上在线下能实现这些功能，上传到Appstore的App也应该没问题。如有朋友遇到问题，欢迎随时留言。</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/21/线上APP使用动态库添加需求方式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/01/21/线上APP使用动态库添加需求方式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/07/动态修复线上bug/" title="动态修复线上bug" itemprop="url">动态修复线上bug</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="luoyan" target="_blank" itemprop="author">luoyan</a>
		
  <p class="article-time">
    <time datetime="2016-01-07T06:23:00.000Z" itemprop="datePublished"> 发表于 2016-01-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这个主题是在QQ空间终端开发团队公众号的一篇文章看到的(<a href="http://zhuanlan.zhihu.com/magilu/20288657" target="_blank" rel="external">链接地址</a>)，平时开发中确实没有使用过，为了以后派上用途，在这写这篇文章记录一下。QQ空间终端开发团队公众号一文中提到的使用TPatch来动态修复补丁，我找了很久确没找到TPatch的下载地址，而且他还不开源，但通过他我却了解到其他比较好用的动态修复补丁的框架，比如<a href="http://jspatch.com" target="_blank" rel="external">JSPatch</a>,这篇文章我就JSPatch来记录如何使用JSPatch修复线上APP的bug。</p>
<h3 id="修复的基本原理"><a href="#修复的基本原理" class="headerlink" title="修复的基本原理"></a>修复的基本原理</h3><p>能实现线上修复bug的最根本的原理是因为 Objective-C 是一门动态语言，OC上所有方法的调用/类的生成都通过 Objective-C Runtime 在运行时进行，所以我们可以通过类名/方法名反射得到相应的类和方法，也可以替换某个类的方法为新的实现，还可以新注册一个类，为类添加方法。</p>
<h3 id="JSPatch的使用"><a href="#JSPatch的使用" class="headerlink" title="JSPatch的使用"></a>JSPatch的使用</h3><ol>
<li>获得AppKey<br>首先你得先去<a href="http://jspatch.com/Index/invite" target="_blank" rel="external">JSPatch申请账号</a>，获得AppKey，每个App都有对应的一个唯一AppKey。</li>
<li>下载SDK并导入工程<br>下载 SDK 后解压，将 JSPatch.framework 导入到工程中，并添加两个系统库文件：libz.dylib 和 JavaScriptCore.framework。</li>
<li>添加代码<br>在 AppDelegate.m 里载入文件，并调用 +startWithAppKey: 方法，参数为第一步获得的 AppKey。例子：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;JSPatch/JSPatch.h&gt;</div><div class="line">@implementation AppDelegate</div><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</div><div class="line">    [JSPatch startWithAppKey:@&quot;你申请的AppKey&quot;];</div><div class="line">    // your code</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ol>
<p>至此 JSPatch 接入完毕，接着你就可以在后台为这个 APP 添加JS补丁了。<br>4.JS补丁代码如何写<br>写到这里，其实自己也并不太熟悉 JS 补丁代码的基本语法，不过还好他提供了<a href="https://github.com/bang590/JSPatch/wiki/基础用法" target="_blank" rel="external">文档</a>，更好的是提供了机器人帮你将OC代码转换成JS代码，<a href="http://bang590.github.io/JSPatchConvertor/" target="_blank" rel="external">转换地址</a>，不过提供转换的功能实现简单的OC代码还行，比较复杂的还需人工修复，所以：如果有使用到动态修复线上 APP Bug，并且选择使用了 JSPatch，那么你就不的不好好学习一下 JS 补丁代码的语法了。</p>
<h3 id="补丁版本支持"><a href="#补丁版本支持" class="headerlink" title="补丁版本支持"></a>补丁版本支持</h3><ol>
<li>可针对APP中对应的版本发布补丁代码。</li>
<li>可修改已经发布的补丁脚本代码，既重新上传该版本的脚本代码，APP重新启动时，会请求判断是否已经更新，若更新了会下载最新脚本代码覆盖原来的脚本代码，启动后并执行。</li>
<li>可移除已经发布的补丁脚本代码，只要在后台页面删除该版本的APP，客户端APP请求是发现该版本已经被删除，则会自动删除本地的补丁脚本代码。</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>既然有这么好用的东西，记录下来并不是一件坏事，说不定以后能排上用场。另外，估计大家也会想到，既然这么强大，那为啥还要发布新版本，直接都通过 JS 脚本代码来实现新需求，这不避免了重新上线中一大堆麻烦的事情了吗？其实解决一些小问题还是可以，如果有大批需求需要上线，估计使用这种方式还是不太妥当，毕竟通过脚本代码转换到OC是需要消耗一定的性能的。</p>
<hr>
<blockquote>
<p>参考文献:<br><a href="http://blog.cnbang.net/tech/2808/" target="_blank" rel="external">JSPatch实现原理详解</a><br><a href="http://jspatch.com" target="_blank" rel="external">JSPatch</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/07/动态修复线上bug/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/01/07/动态修复线上bug/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="lyroger" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://lyroger.github.io" target="_blank" title="我的技术博客">我的博客</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="http://lyroger.github.io/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m luoyan Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3314058724" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/lyroger" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:yan1079@126.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="luoyan">luoyan</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
