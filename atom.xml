<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>罗琰的技术博客</title>
  <subtitle>积累与分享成长的技术经验</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lyroger.github.io/"/>
  <updated>2016-09-19T05:57:31.000Z</updated>
  <id>http://lyroger.github.io/</id>
  
  <author>
    <name>luoyan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello Hexo</title>
    <link href="http://lyroger.github.io/2016/08/30/hello-hexo/"/>
    <id>http://lyroger.github.io/2016/08/30/hello-hexo/</id>
    <published>2016-08-30T07:23:52.000Z</published>
    <updated>2016-09-19T05:57:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Jenkins+Git自动构建</title>
    <link href="http://lyroger.github.io/2016/08/25/Jenkins+Git%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA/"/>
    <id>http://lyroger.github.io/2016/08/25/Jenkins+Git自动构建/</id>
    <published>2016-08-25T09:52:00.000Z</published>
    <updated>2016-09-19T07:58:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>   想想以前，发给测试的测试包都是通过手动使用XCode来打包，如果项目工程比较大，Archive过程时间还是比较长的，打多了觉得特没劲，非常浪费时间，特别是使用了敏捷开发流程的，要是还用手动打包，估计你在打包上耗得时间都够你解决几个bug了。敏捷开发也是强调使用自动化的，所以也少不了自动构建的环节，那么接下来说说如何使用Jenkins+Git来自动构建我们的项目，从而方便测试，也让开发有更多的经历投入到编码和业务中而不是浪费在这些无用的流程中。</p>
<h2 id="一-Jenkins安装"><a href="#一-Jenkins安装" class="headerlink" title="一.Jenkins安装"></a>一.Jenkins安装</h2><p>1.下载最新的版本（一个 WAR 文件）。<a href="http://Jenkins-ci.org/" target="_blank" rel="external">Jenkins官方网址</a><br>2.运行 Java -jar jenkins.war 。<br>如果你的java环节低于java7 它会提示你升级java环节，你可以到<a href="https://www.java.com/en/download/" target="_blank" rel="external">这里下载</a>，安装最新的java环境。<br>如果一切顺利，那么只要在你本机浏览器中输入<a href="http://127.0.0.1:8080" target="_blank" rel="external">127.0.0.1:8080</a>即可看到Jenkins的主页面。<br><img src="/images/jenins首页.png" alt=""></p>
<h2 id="二-Jenkins配置"><a href="#二-Jenkins配置" class="headerlink" title="二.Jenkins配置"></a>二.Jenkins配置</h2><p>1.先新建一个项目。<br><img src="/images/创建项目.png" alt=""><br>2.输入项目名称和构建风格。<br><img src="/images/创建项目1.png" alt=""><br>3.项目配置</p>
<p><img src="/images/配置项目-项目名称.png" alt=""><br>4.源码管理</p>
<p><img src="/images/项目配置-源码管理.png" alt=""><br>这一步输入你项目在Git上的仓库地址，这里的授权有两种形式，一种是使用http登录，一种是使用ssh授权；<br>*如果使用http授权的看下图：</p>
<p><img src="/images/项目配置-源码管理添加http授权.png" alt=""><br>这里输入你git上的登录名和密码。<br>*如果使用SSH授权看下图：</p>
<p><img src="/images/项目配置-源码管理SSH授权创建.png" alt=""><br>kind要选择SSH Username with private key,Username可以随便输入，一个描述而已，Private Key选Enter directly，然后在Key中输入你在Git上的秘钥，这个秘钥的制作在我前面的<a href="http://roger.farbox.com/post/macshang-zhi-zuo-sshmi-yao" target="_blank" rel="external">博客</a>中有提到，这里就不多说了。最后点击Add，SSH的授权就制作OK了。<br>5.构建<br>源码可以下载了，那么接下来就是如何去生成一个ipa包了，我们通过构建的方式来实现，接下来我们来配置一下构建流程，构建的方式很多中，这里讲讲比较简单的一种，使用shell来实现。</p>
<p><img src="/images/构建1.png" alt=""></p>
<p><img src="/images/项目配置-构建配置.png" alt=""><br>编写脚本，这个脚本支持的是workspace的，如果没有使用workspace的，问题不大，稍作修改即可。脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">cd $WORKSPACE</div><div class="line">SDK_VERSION=&quot;iphoneos8.3&quot;</div><div class="line"></div><div class="line">PROJECT_NAME=&quot;JenkinsDemo&quot;</div><div class="line">PROVISION_UUID=&quot;你的描述文件的UUID，可以通过在XCode选中描述文件ctr+c的方法获取到&quot;</div><div class="line">PROVISONING_PROFILE=&quot;JenkinsDemo_Distribution&quot;</div><div class="line"></div><div class="line">XCODE_PRJ=&quot;xcodeproj&quot;</div><div class="line">FILE_EXTENSION=&apos;xcworkspace&apos;</div><div class="line">PROJECT_DIR=`pwd`</div><div class="line">CD_XCODE_PRJ=`pwd`/$PROJECT_NAME.$XCODE_PRJ</div><div class="line">PROJECT_WORKSPACE=$PROJECT_DIR.</div><div class="line">PROJECT_BUILD=`pwd`/$PROJECT_NAME/BUILD</div><div class="line"></div><div class="line">APP_PATH=&quot;build/Release-iphoneos/$&#123;PROJECT_NAME&#125;.app&quot;</div><div class="line">TARGET_APP_PATH=&quot;build/Release-iphoneos/$&#123;PROJECT_NAME&#125;.ipa&quot;</div><div class="line">ARCHIVEPATH=&quot;build/Release-iphoneos/$&#123;PROJECT_NAME&#125;.xcarchive&quot;</div><div class="line"></div><div class="line">cd &quot;$PROJECT_DIR&quot;</div><div class="line"></div><div class="line">cd ..</div><div class="line">cd &quot;$CD_XCODE_PRJ&quot;</div><div class="line">sed -i &apos;&apos; &quot;s/\(PROVISIONING_PROFILE.=.\&quot;\).*\(\&quot;\)/\1$PROVISION_UUID\2/g&quot; project.pbxproj</div><div class="line">cd ..</div><div class="line">rm -rf build</div><div class="line">xcodebuild -workspace $PROJECT_DIR/$PROJECT_NAME.$FILE_EXTENSION -scheme $PROJECT_NAME -destination generic/platform=iOS archive -archivePath $ARCHIVEPATH</div><div class="line">xcodebuild -exportArchive -exportFormat IPA -archivePath $ARCHIVEPATH -exportPath $TARGET_APP_PATH -exportProvisioningProfile &quot;$&#123;PROVISONING_PROFILE&#125;&quot;</div><div class="line">curl -F &quot;file=@build/Release-iphoneos/JenkinsDemo.ipa&quot; -F &quot;uKey=蒲公英上的uKey&quot; -F &quot;_api_key=蒲公英上的apikey&quot; https://www.pgyer.com/apiv1/app/upload</div></pre></td></tr></table></figure></p>
<p>*构建成功后这里可能会出现一个问题，你的项目工程中的配置需要设置一下shared，不然构建的会一直报错。找不到工程文件，如下图设置：</p>
<p><img src="/images/工程配置.png" alt=""><br>*OK，保存构建后，接下来就可以回到项目管理页面了。</p>
<p><img src="/images/项目管理-立即构建.png" alt=""><br><em>一般构建在一分钟左右，先下载源代码，然后打包，最后将ipa包上传到蒲公英平台。
</em>可以看出，构建后蓝色的表示构建成功，红色和灰色表示构建失败，可以点击相应的图标，查看构建日志。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;   想想以前，发给测试的测试包都是通过手动使用XCode来打包，如果项目工程比较大，Archive过程时间还是比较长的，打多了觉得特没劲，
    
    </summary>
    
      <category term="工具" scheme="http://lyroger.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>swift实战</title>
    <link href="http://lyroger.github.io/2016/07/18/swift%E5%AE%9E%E6%88%98/"/>
    <id>http://lyroger.github.io/2016/07/18/swift实战/</id>
    <published>2016-07-18T03:26:00.000Z</published>
    <updated>2016-09-19T07:57:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="OC调用swift方式"><a href="#OC调用swift方式" class="headerlink" title="OC调用swift方式"></a>OC调用swift方式</h2><p>在OC代码中引入头文件 #import “项目名称-swift.h”<br>即可用OC语法调用swift写的代码了。</p>
<h2 id="swift中如何写Block"><a href="#swift中如何写Block" class="headerlink" title="swift中如何写Block"></a>swift中如何写Block</h2><p>在swift中定义一个闭包的关键词为 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">在A类中定义一个闭包</div><div class="line">``` swift</div><div class="line">//定义一个闭包</div><div class="line">typealias LoginSuceesedBlock = (successed:Bool)-&gt;Void</div><div class="line">class LoginViewController:UIViewController&#123;</div><div class="line">    //将函数指针赋值给loginActionBlock闭包</div><div class="line">    func initWithBlock(closure:LoginSuceesedBlock?)&#123;</div><div class="line">        loginActionBlock = closure</div><div class="line">    &#125;</div><div class="line">    private func loginAction(sender:AnyObject?) &#123;</div><div class="line">        let loginSuccessed:Bool = loginViewModel.loginRequestAction(textUserName.text!,passWord: textPwd.text!)</div><div class="line">        if loginSuccessed &#123;</div><div class="line">            //block 回调</div><div class="line">            if (loginActionBlock != nil) &#123;</div><div class="line">                self.loginActionBlock!(successed: true)</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            let alert:UIAlertView =  UIAlertView()</div><div class="line">            alert.title = &quot;提示&quot;</div><div class="line">            alert.message = &quot;登录失败&quot;</div><div class="line">            alert.addButtonWithTitle(&quot;OK&quot;)</div><div class="line">            alert.show()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在B类中传一个函数到A类<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">authorizeOperation</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> loginVC = <span class="type">LoginViewController</span>()</div><div class="line">        loginVC.initWithBlock(loginActionSuccessed)</div><div class="line">        <span class="keyword">self</span>.navigationController?.pushViewController(loginVC, animated: <span class="literal">true</span>)</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginActionSuccessed</span><span class="params">(successed:Bool)</span></span> -&gt; <span class="type">Void</span> &#123;</div><div class="line">        <span class="keyword">if</span> successed &#123;</div><div class="line">            <span class="comment">//todo loginSuccessed something</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;OC调用swift方式&quot;&gt;&lt;a href=&quot;#OC调用swift方式&quot; class=&quot;headerlink&quot; title=&quot;OC调用swift方式&quot;&gt;&lt;/a&gt;OC调用swift方式&lt;/h2&gt;&lt;p&gt;在OC代码中引入头文件 #import “项目名称-swift.h”
    
    </summary>
    
      <category term="swift" scheme="http://lyroger.github.io/categories/swift/"/>
    
    
  </entry>
  
  <entry>
    <title>MVVM模式的学习</title>
    <link href="http://lyroger.github.io/2016/07/08/MVVM%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AD%A6%E4%B9%A0/"/>
    <id>http://lyroger.github.io/2016/07/08/MVVM模式的学习/</id>
    <published>2016-07-08T03:15:00.000Z</published>
    <updated>2016-09-19T07:58:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一 前言"></a>一 前言</h2><p>这里就不多说为什么要学习MVVM模式了，新东西当然需要有一颗进步的心态去接纳它，不管他是否真的能在实际开发中帮到你，我想至少会在某种场景中用到。好吧，我们先来理解一下什么是MVVM模式吧。</p>
<h2 id="MVVM的理解"><a href="#MVVM的理解" class="headerlink" title="MVVM的理解"></a>MVVM的理解</h2><p>MVVM这种模式其实是来自<a href="https://msdn.microsoft.com/en-us/library/hh848246.aspx" target="_blank" rel="external">微软</a>的，我们用一张视图来概括一下MVVM吧</p>
<p><img src="/images/mvvm.png" alt=""><br>从这个图可以看出，view和View Controller都归纳为View，即V，视图相关的业务逻辑以后就写到这里了，中间的ViewModel用来写MVC中Controller的一部分逻辑，比如网络请求的业务逻辑，视图展示数据的业务逻辑等等，这样以前的Controller的业务逻辑代码岂不是变少了很多，在实际使用当中，Controller的代码也变得非常清晰，因为你只会关注业务逻辑，而不会去关注这些数据怎么来的，怎么组装的等等这些细节了。Model还是以前MVC中的model没有什么变化，然而这三个层级的关系又是如何的呢？View只引用ViewModel，View通过Action来改变ViewModel，ViewMode的业务来更新View，注意ViewModel不要去引用View，ViewModel只是写了一些组装数据的业务逻辑而已，把控好各个层级的关系可以把你的项目写的很清晰。ViewMode中引用Model，ViewModel的网络请求，数据组装等等业务逻辑的结果都保存到了Model中，Model一旦有更新会通知ViewModel，一旦View有需求更新或ViewModel变更需要通知View，这个时候就可以去更新View了。如果理解的简单点，应该就是一个双向绑定的关系，View跟ViewModel绑定，一旦ViewModel有变更，View更新；ViewModel更Model绑定，一旦Model有变更，则会通知ViewModel，继而会更新View。</p>
<h2 id="MVVM与MVC的对比"><a href="#MVVM与MVC的对比" class="headerlink" title="MVVM与MVC的对比"></a>MVVM与MVC的对比</h2><p>MVVM较MVC的好处个人觉得最重要的应该是将臃肿的Controller解放了，有一大部分业务逻辑分解到了ViewModel中来了；其次应该就是做单元测试比较方便。因为很多业务逻辑已经抽象出成单独的方法，很容易做单元测试。当然个人也有一些用MVVM比较麻烦的地方，在一些较简单的Controller中，写MVVM模式，确实又有点累赘，增加了一些代码量。但总体来说，MVVM确实把代码的复杂度降下来了。</p>
<h2 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h2><p>说到最后，有一个推荐的框架比较适合MVVM，也是最近在学习的一个框架<a href="http://roger.farbox.com/post/reactivecocoaxue-xi" target="_blank" rel="external">ReactiveCocoa</a></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>写了这些都是自己的个人理解，还并未去实际，若有理解出入，还望谅解。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一-前言&quot;&gt;&lt;a href=&quot;#一-前言&quot; class=&quot;headerlink&quot; title=&quot;一 前言&quot;&gt;&lt;/a&gt;一 前言&lt;/h2&gt;&lt;p&gt;这里就不多说为什么要学习MVVM模式了，新东西当然需要有一颗进步的心态去接纳它，不管他是否真的能在实际开发中帮到你，我想至少
    
    </summary>
    
      <category term="设计模式" scheme="http://lyroger.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>Mac上制作SSH秘钥</title>
    <link href="http://lyroger.github.io/2016/07/07/Mac%E4%B8%8A%E5%88%B6%E4%BD%9CSSH%E7%A7%98%E9%92%A5/"/>
    <id>http://lyroger.github.io/2016/07/07/Mac上制作SSH秘钥/</id>
    <published>2016-07-07T09:16:00.000Z</published>
    <updated>2016-09-19T07:59:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>打开终端，$ ssh-keygen 一路enter下。<br>生成  在当前用户名下 会有一个.sh文件。<br>查看 .ssh<br>$ ls -a ~/.ssh  通过搜索目录<br>id_rsa<br>id_rsa.pub<br>打开  id_rsa.pub文件 里面就有需要的ssh key。<br>或者使用文本编辑工具打开该文件，命令是：<br>vim ~/.ssh/id_rsa.pub</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;打开终端，$ ssh-keygen 一路enter下。&lt;br&gt;生成  在当前用户名下 会有一个.sh文件。&lt;br&gt;查看 .ssh&lt;br&gt;$ ls -a ~/.ssh  通过搜索目录&lt;br&gt;id_rsa&lt;br&gt;id_rsa.pub&lt;br&gt;打开  id_rsa.pub文件 里面
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>ReactiveCocoa学习</title>
    <link href="http://lyroger.github.io/2016/07/06/ReactiveCocoa%E5%AD%A6%E4%B9%A0/"/>
    <id>http://lyroger.github.io/2016/07/06/ReactiveCocoa学习/</id>
    <published>2016-07-06T01:39:00.000Z</published>
    <updated>2016-09-19T07:58:04.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、signal的释放问题"><a href="#一、signal的释放问题" class="headerlink" title="一、signal的释放问题"></a>一、signal的释放问题</h2><p>当signal作为local变量时，如果没有被subscribe，那么方法执行完后，该变量会被dealloc。但如果signal有被subscribe，那么subscriber会持有该signal，直到signal sendCompleted或sendError时，才会解除持有关系，signal才会被dealloc。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、signal的释放问题&quot;&gt;&lt;a href=&quot;#一、signal的释放问题&quot; class=&quot;headerlink&quot; title=&quot;一、signal的释放问题&quot;&gt;&lt;/a&gt;一、signal的释放问题&lt;/h2&gt;&lt;p&gt;当signal作为local变量时，如果没有被sub
    
    </summary>
    
      <category term="框架" scheme="http://lyroger.github.io/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
  </entry>
  
  <entry>
    <title>iOS基础深究</title>
    <link href="http://lyroger.github.io/2016/02/25/iOS%E5%9F%BA%E7%A1%80%E6%B7%B1%E7%A9%B6/"/>
    <id>http://lyroger.github.io/2016/02/25/iOS基础深究/</id>
    <published>2016-02-25T01:37:00.000Z</published>
    <updated>2016-09-19T07:59:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、assign与weak的区别"><a href="#一、assign与weak的区别" class="headerlink" title="一、assign与weak的区别"></a>一、assign与weak的区别</h2><p>assign适用于基本数据类型，weak是适用于NSObject对象，并且是一个弱引用。<br>assign其实也可以用来修饰对象，那么我们为什么不用它呢？因为被assign修饰的对象在释放之后，指针的地址还是存在的，也就是说指针并没有被置为nil。如果在后续的内存分配中，刚好分到了这块地址，程序就会崩溃掉。<br>而weak修饰的对象在释放之后，指针地址会被置为nil。所以现在一般弱引用就是用weak。<br>所以在使用assign修饰对象，就有可能会导致程序EXC_BAD_ACCESS异常，也就是所谓的野指针错误！</p>
<h2 id="二、nonatomic与atomic"><a href="#二、nonatomic与atomic" class="headerlink" title="二、nonatomic与atomic"></a>二、nonatomic与atomic</h2><p>nonatomic: 非原子性访问，对属性赋值的时候不加锁，多线程并发访问会提高性能。若不加此属性，则默认是两个访问方法都为原子型事务访问。<br>atomic:是Objc使用的一种线程保护技术，基本上来讲，是防止在写未完成的时候被另外一个线程读取，造成数据错误。而这种机制是耗费系统资源的，所以在iPhone这种小型设备上，如果没有使用多线程间的通讯编程，那么nonatomic是一个非常好的选择。</p>
<h2 id="三、ARC模式下重写set方法"><a href="#三、ARC模式下重写set方法" class="headerlink" title="三、ARC模式下重写set方法"></a>三、ARC模式下重写set方法</h2><p>网上很多人说直接赋值就OK了，我感觉不太妥，这里我验证了下，如果是strong修饰的属性，是可以直接赋值的，如果是copy，那么需要copy一份了。看看下面代码<br>1.首先定义两个copy属性及测试方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic,copy) NSString *test;</div><div class="line">@property (nonatomic,copy) NSMutableString *testMutableString;</div><div class="line">......</div><div class="line">//测试方法</div><div class="line">- (void)testProperty</div><div class="line">&#123;</div><div class="line">    NSString *testString = @&quot;test&quot;;</div><div class="line">    NSMutableString *testMutableString = [NSMutableString stringWithFormat:@&quot;testMutableString&quot;];</div><div class="line">    self.test = testString;</div><div class="line">    self.testMutableString = testMutableString;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.重写两个属性的set方法，验证直接赋值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)setTest:(NSString *)test</div><div class="line">&#123;</div><div class="line">    _test = test;</div><div class="line">    NSLog(@&quot;_test = %p,test = %p&quot;,_test,test);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setTestMutableString:(NSMutableString *)testMutableString</div><div class="line">&#123;</div><div class="line">    _testMutableString = testMutableString;</div><div class="line">    NSLog(@&quot;_testMutableString = %p,testMutableString = %p&quot;,_testMutableString,testMutableString);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>打印出来的日志显示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-02-25 10:23:30.618 DemoList[4341:2473539] _test = 0x1001364d0,test = 0x1001364d0</div><div class="line">2016-02-25 10:23:30.621 DemoList[4341:2473539] _testMutableString = 0x13ef2b950,testMutableString = 0x13ef2b950</div></pre></td></tr></table></figure></p>
<p>直接赋值的方式从这里可以看出来，打印的地址都是一样的，只是引用而已，并没有产生新的对象。<br>3.我们再来看看copy一份的结果。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)setTest:(NSString *)test</div><div class="line">&#123;</div><div class="line">    _test = [test copy];</div><div class="line">    NSLog(@&quot;_test = %p,test = %p&quot;,_test,test);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setTestMutableString:(NSMutableString *)testMutableString</div><div class="line">&#123;</div><div class="line">    _testMutableString = [testMutableString copy];</div><div class="line">    NSLog(@&quot;_testMutableString = %p,testMutableString = %p&quot;,_testMutableString,testMutableString);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>//打印出来的日志显示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-02-25 10:12:26.642 DemoList[4332:2471119] _test = 0x10018a4d0,test = 0x10018a4d0</div><div class="line">2016-02-25 10:12:26.645 DemoList[4332:2471119] _testMutableString = 0x15d76b6d0,testMutableString = 0x15d6abd40</div></pre></td></tr></table></figure></p>
<p>这个时候你会发现，NSString的属性地址还是一样的，NSMutabeString的属性地址不一样了，这样就对了，NSString的属性其实希望的就是引用一份，而可变字符的就是希望真正的copy一份，如果地址还一样，那么就没必要使用可变的对象了。<br>总结下ARC模式的set方法，使用copy修饰属性时，最好使用copy去赋值。其他的可以直接赋值就是了。</p>
<h2 id="四、block属性为什么需要使用copy修饰"><a href="#四、block属性为什么需要使用copy修饰" class="headerlink" title="四、block属性为什么需要使用copy修饰"></a>四、block属性为什么需要使用copy修饰</h2><p>因为block变量默认是声明为栈变量的，为了能够在block的声明域外使用，所以要把block拷贝（copy）到堆，所以说为了block属性声明和实际的操作一致，最好声明为copy。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、assign与weak的区别&quot;&gt;&lt;a href=&quot;#一、assign与weak的区别&quot; class=&quot;headerlink&quot; title=&quot;一、assign与weak的区别&quot;&gt;&lt;/a&gt;一、assign与weak的区别&lt;/h2&gt;&lt;p&gt;assign适用于基本数据类
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>关于字符串的分割</title>
    <link href="http://lyroger.github.io/2016/02/24/%E5%85%B3%E4%BA%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%88%86%E5%89%B2/"/>
    <id>http://lyroger.github.io/2016/02/24/关于字符串的分割/</id>
    <published>2016-02-24T02:47:00.000Z</published>
    <updated>2016-09-19T07:59:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天在字符串分割上遇到一个坑，一不小心便踩了，问题是这样的：我接收到服务端传过来的一个包含多个图片地址的字符串，使用“,”分割，我使用”componentsSeparatedByString:”来分割，将多个图片地址存入数组，并根据数组的个数来加载默认图片，等图片下载完成后替换对应的默认图片。现在服务端给我返回了一个@””字符串，我的代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSArray *descImages = [descImage componentsSeparatedByString:@&quot;,&quot;];</div></pre></td></tr></table></figure></p>
<p>其实这个时候descImage等于””，但使用”componentsSeparatedByString:”分割返回的数组是有一个对象的，就是一个空字符串，这个可能我并没想到，导致服务端返回空字符串时，我这边也多加载了一个图片，这个图片还一直下载不下来。这个也让我明白：”componentsSeparatedByString:”的意思，有分割字符就根据字符分割返回数组，没分割字符则返回被分割的字符串，@””也是一个字符串，它也是有内存地址的，跟nil并不一样。看看下面的代码就明白了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)testComponentSeparatedByString</div><div class="line">&#123;</div><div class="line">    NSString *descImage = @&quot;&quot;;</div><div class="line">    NSArray *descImages = [descImage componentsSeparatedByString:@&quot;,&quot;];</div><div class="line">    NSLog(@&quot;descImages = %@,descImages.count=%zd,descImage = %p,nil= %p&quot;,descImages,descImages.count,descImage,nil);</div><div class="line">&#125;</div><div class="line">打印出来的</div><div class="line">descImages = (</div><div class="line">    &quot;&quot;</div><div class="line">),descImages.count=1,descImage = 0x1001d5690,nil= 0x0</div></pre></td></tr></table></figure></p>
<p>因此要解决这个问题就得加一个判断给descImage.length&gt;0即可。</p>
<h3 id="衍生学习"><a href="#衍生学习" class="headerlink" title="衍生学习"></a>衍生学习</h3><p>componentsSeparatedByCharactersInSet的使用，使用多个字符分割字符串：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NSString *str = @&quot;A~B^C&quot;;</div><div class="line">NSArray *arr = [str componentsSeparatedByCharactersInSet:[NSCharacterSet characterSetWithCharactersInString:@&quot;^~&quot;]];</div><div class="line">NSLog(@&quot;%@&quot;, arr);</div><div class="line">打印出来</div><div class="line">(</div><div class="line">    A,</div><div class="line">    B,</div><div class="line">    C</div><div class="line">)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天在字符串分割上遇到一个坑，一不小心便踩了，问题是这样的：我接收到服务端传过来的一个包含多个图片地址的字符串，使用“,”分割，我使用”componentsSeparatedByString:”来分割，将多个图片地址存入数组，并根据数组的个数来加载默认图片，等图片下载完成后
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>动态添加需求(动态库)</title>
    <link href="http://lyroger.github.io/2016/01/21/%E7%BA%BF%E4%B8%8AAPP%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93%E6%B7%BB%E5%8A%A0%E9%9C%80%E6%B1%82%E6%96%B9%E5%BC%8F/"/>
    <id>http://lyroger.github.io/2016/01/21/线上APP使用动态库添加需求方式/</id>
    <published>2016-01-21T06:26:00.000Z</published>
    <updated>2016-09-19T08:01:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前些天，公司提出需要动态添加一些需求给线上App，当时觉得有点不太好办，因为当时还没有头绪，后来上网查了些资料，如<a href="http://blog.csdn.net/like7xiaoben/article/details/44081257" target="_blank" rel="external">这篇文章</a>，不过他这只是将写好的动态库拷贝到本地的沙盒中，也就是有这个方法然后我有了头绪，我只需将写好的动态库压缩上传到服务器，提供线上APP下载，解压后加载动态库执行代码即可实现其功能。接下来还是来看看具体操作和过程中遇到的一些问题和注意点吧。整个需求我写了一个<a href="https://github.com/lyroger/DynamicDemo" target="_blank" rel="external">demo</a>,你可以先下载这个<a href="https://github.com/lyroger/DynamicDemo" target="_blank" rel="external">demo</a>,对照此文章来理解。</p>
<h3 id="一、生成动态库"><a href="#一、生成动态库" class="headerlink" title="一、生成动态库"></a>一、生成动态库</h3><p>Xcode6就支持动态库了，所以只要使用XCode6及更高版本的XCode便可以生成动态库。<br><img src="/images/9E729546-8D22-48A6-A3D7-88FBDD787DD9.png" alt=""><br>此demo中满足需求的动态库我取名叫DynamicFramework.framework。在这个动态库中我实现了弹出一个UIViewController和在这个UIViewController中加载了动态库中的资源文件。并在这个动态库中引用了其他的动态库（此的demo中引用的是CommonFramework.framework），并调用其他库中的方法。这样就可以满足灵活调用和灵活添加需求的要求了。如果你需要给线上app提供动态库，你可以将写好的动态库压缩上传到服务器提供下载。</p>
<h3 id="二、加载动态库"><a href="#二、加载动态库" class="headerlink" title="二、加载动态库"></a>二、加载动态库</h3><p>在主工程中我们来加载写好的动态库，从网络下载的过程我在demo就没实现了，只做了将下下来的zip文件解压的操作，加载动态库步骤很简单，先将服务器上的DynamicFramework.framework.zip文件下载到沙盒的document中（当然，如果只是写Demo，你完全可以手动拷贝到document中），找到该zip文件，解压到同一个目录下，然后将动态库复制到程序中，即可使用，具体代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">- (void)loadDynamicFrameworkModel</div><div class="line">&#123;</div><div class="line">    NSArray* paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES);</div><div class="line">    NSString *documentDirectory = nil;</div><div class="line">    if ([paths count] != 0)</div><div class="line">        documentDirectory = [paths objectAtIndex:0];</div><div class="line">    </div><div class="line">    //本地动态库文件</div><div class="line">    NSString *libName = @&quot;DynamicFramework.framework&quot;;</div><div class="line">    NSString *destLibPath = [documentDirectory stringByAppendingPathComponent:libName];</div><div class="line">    </div><div class="line">    //第一步，判断是否存在动态库文件</div><div class="line">    NSFileManager *manager = [NSFileManager defaultManager];</div><div class="line">    if (![manager fileExistsAtPath:destLibPath]) &#123;</div><div class="line">        NSLog(@&quot;没有动态库文件&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    //第三步，复制到程序中</div><div class="line">    NSBundle *frameworkBundle = [NSBundle bundleWithPath:destLibPath];</div><div class="line">    if (frameworkBundle &amp;&amp; [frameworkBundle load]) &#123;</div><div class="line">        NSLog(@&quot;load Bundle success&quot;);</div><div class="line">    &#125; else &#123;</div><div class="line">        NSLog(@&quot;load Bundle failed&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意:如果出问题了，是不是跟如下类似的错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error loading ...... no suitable image found.  Did find: ...</div></pre></td></tr></table></figure></p>
<p>其实这个错误就是我当初最当心的问题，这个就是由于写动态库时打包的签名和主工程打包的签名不一致导致主工程加载下载下来的动态库失败产生的错误。解决这个错误的办法就是保证你后续写的动态库打包时签名一定要跟线上发布的APP签名一致，否则App并不会执行你的动态库。</p>
<h3 id="三、调用动态库"><a href="#三、调用动态库" class="headerlink" title="三、调用动态库"></a>三、调用动态库</h3><p>将动态库加载到程序中后，接下来就是调用动态库中的代码了。<br>1.首先我们用运行时来加载动态库中的类，窥探是否有该类，以防使用报错奔溃。<br>2.如果有动态库入口的方法类，我们则使用NSObject类 “- (id)performSelector:(SEL)aSelector withObject:(id)object1 withObject:(id)object2”来执行。<br>这一步我们可以将主工程中的一些变量传入动态库中，供动态库使用，完成新需求。特别是资源信息，以下将frameworkBundle信息传入动态库中供期获取资源。<br>调用代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//第四步，获取动态库中入口类</div><div class="line">Class pacteraClass = NSClassFromString(@&quot;DynamaicEnterance&quot;);</div><div class="line">if (!pacteraClass) &#123;</div><div class="line">    NSLog(@&quot;Unable to get DynamicFramework class&quot;);</div><div class="line">    return;</div><div class="line">&#125;</div><div class="line">//第五步，执行动态库中入口类的方法</div><div class="line">NSObject *pacteraObject = [pacteraClass new];</div><div class="line">[pacteraObject performSelector:@selector(showViewOnController:withBundle:) withObject:self withObject:frameworkBundle];</div></pre></td></tr></table></figure></p>
<p>动态库中DynamaicEnterance类只要实现showViewOnController:withBundle:方法就可以了。<br>在此方法中你可以做你想做的事情，这个桥接过程就已经完成了。此demo中就实现弹出一个UIViewcontroller并加载动态库中的图片资源和调用其他库中的函数。</p>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>总而言之，自从苹果支持动态库后，确实方便了许多。</p>
<ol>
<li>如果你跟我的需求一致，使用方式一致，请一定记住，你的动态库的签名需跟你的主App的签名一致，否则你的动态库将无法加载到主工程中，你的代码也将无法执行。</li>
<li>生成动态库只在iOS8及更高版本支持，但并不影响低版本使用。</li>
<li>使用动态库实现动态新增需求我并没有在线上APP中实现过，只实现与自己写的Demo。理论上在线下能实现这些功能，上传到Appstore的App也应该没问题。如有朋友遇到问题，欢迎随时留言。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;前些天，公司提出需要动态添加一些需求给线上App，当时觉得有点不太好办，因为当时还没有头绪，后来上网查了些资料，如&lt;a href=&quot;http
    
    </summary>
    
      <category term="高效篇" scheme="http://lyroger.github.io/categories/%E9%AB%98%E6%95%88%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>动态修复线上bug</title>
    <link href="http://lyroger.github.io/2016/01/07/%E5%8A%A8%E6%80%81%E4%BF%AE%E5%A4%8D%E7%BA%BF%E4%B8%8Abug/"/>
    <id>http://lyroger.github.io/2016/01/07/动态修复线上bug/</id>
    <published>2016-01-07T06:23:00.000Z</published>
    <updated>2016-09-19T08:03:33.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这个主题是在QQ空间终端开发团队公众号的一篇文章看到的(<a href="http://zhuanlan.zhihu.com/magilu/20288657" target="_blank" rel="external">链接地址</a>)，平时开发中确实没有使用过，为了以后派上用途，在这写这篇文章记录一下。QQ空间终端开发团队公众号一文中提到的使用TPatch来动态修复补丁，我找了很久确没找到TPatch的下载地址，而且他还不开源，但通过他我却了解到其他比较好用的动态修复补丁的框架，比如<a href="http://jspatch.com" target="_blank" rel="external">JSPatch</a>,这篇文章我就JSPatch来记录如何使用JSPatch修复线上APP的bug。</p>
<h3 id="修复的基本原理"><a href="#修复的基本原理" class="headerlink" title="修复的基本原理"></a>修复的基本原理</h3><p>能实现线上修复bug的最根本的原理是因为 Objective-C 是一门动态语言，OC上所有方法的调用/类的生成都通过 Objective-C Runtime 在运行时进行，所以我们可以通过类名/方法名反射得到相应的类和方法，也可以替换某个类的方法为新的实现，还可以新注册一个类，为类添加方法。</p>
<h3 id="JSPatch的使用"><a href="#JSPatch的使用" class="headerlink" title="JSPatch的使用"></a>JSPatch的使用</h3><ol>
<li>获得AppKey<br>首先你得先去<a href="http://jspatch.com/Index/invite" target="_blank" rel="external">JSPatch申请账号</a>，获得AppKey，每个App都有对应的一个唯一AppKey。</li>
<li>下载SDK并导入工程<br>下载 SDK 后解压，将 JSPatch.framework 导入到工程中，并添加两个系统库文件：libz.dylib 和 JavaScriptCore.framework。</li>
<li>添加代码<br>在 AppDelegate.m 里载入文件，并调用 +startWithAppKey: 方法，参数为第一步获得的 AppKey。例子：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;JSPatch/JSPatch.h&gt;</div><div class="line">@implementation AppDelegate</div><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</div><div class="line">    [JSPatch startWithAppKey:@&quot;你申请的AppKey&quot;];</div><div class="line">    // your code</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ol>
<p>至此 JSPatch 接入完毕，接着你就可以在后台为这个 APP 添加JS补丁了。<br>4.JS补丁代码如何写<br>写到这里，其实自己也并不太熟悉 JS 补丁代码的基本语法，不过还好他提供了<a href="https://github.com/bang590/JSPatch/wiki/基础用法" target="_blank" rel="external">文档</a>，更好的是提供了机器人帮你将OC代码转换成JS代码，<a href="http://bang590.github.io/JSPatchConvertor/" target="_blank" rel="external">转换地址</a>，不过提供转换的功能实现简单的OC代码还行，比较复杂的还需人工修复，所以：如果有使用到动态修复线上 APP Bug，并且选择使用了 JSPatch，那么你就不的不好好学习一下 JS 补丁代码的语法了。</p>
<h3 id="补丁版本支持"><a href="#补丁版本支持" class="headerlink" title="补丁版本支持"></a>补丁版本支持</h3><ol>
<li>可针对APP中对应的版本发布补丁代码。</li>
<li>可修改已经发布的补丁脚本代码，既重新上传该版本的脚本代码，APP重新启动时，会请求判断是否已经更新，若更新了会下载最新脚本代码覆盖原来的脚本代码，启动后并执行。</li>
<li>可移除已经发布的补丁脚本代码，只要在后台页面删除该版本的APP，客户端APP请求是发现该版本已经被删除，则会自动删除本地的补丁脚本代码。</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>既然有这么好用的东西，记录下来并不是一件坏事，说不定以后能排上用场。另外，估计大家也会想到，既然这么强大，那为啥还要发布新版本，直接都通过 JS 脚本代码来实现新需求，这不避免了重新上线中一大堆麻烦的事情了吗？其实解决一些小问题还是可以，如果有大批需求需要上线，估计使用这种方式还是不太妥当，毕竟通过脚本代码转换到OC是需要消耗一定的性能的。</p>
<hr>
<blockquote>
<p>参考文献:<br><a href="http://blog.cnbang.net/tech/2808/" target="_blank" rel="external">JSPatch实现原理详解</a><br><a href="http://jspatch.com" target="_blank" rel="external">JSPatch</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;这个主题是在QQ空间终端开发团队公众号的一篇文章看到的(&lt;a href=&quot;http://zhuanlan.zhihu.com/magilu/
    
    </summary>
    
      <category term="高效篇" scheme="http://lyroger.github.io/categories/%E9%AB%98%E6%95%88%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>runtime那些事（一）</title>
    <link href="http://lyroger.github.io/2015/12/31/runtime%E9%82%A3%E4%BA%9B%E4%BA%8B%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://lyroger.github.io/2015/12/31/runtime那些事（一）/</id>
    <published>2015-12-31T08:48:00.000Z</published>
    <updated>2016-09-19T08:01:48.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>工作中，确实没有刻意去使用runtime机制，作为一种实用的机制，我们不得不去累积这些知识，然后灵活使用。为了为runtime的知识累积，准备写一些关于runtime系列的文章。</p>
<h4 id="一、消息转发机制"><a href="#一、消息转发机制" class="headerlink" title="一、消息转发机制"></a>一、消息转发机制</h4><p>下面一张图详细的概括了每个函数调用的先后以及执行的前提</p>
</blockquote>
<p><img src="/images/runtime消息转发.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;工作中，确实没有刻意去使用runtime机制，作为一种实用的机制，我们不得不去累积这些知识，然后灵活使用。为了为runtime的知识累积，准备写一些关于runtime系列的文章。&lt;/p&gt;
&lt;h4 id=&quot;一、消息转发机制&quot;&gt;&lt;a href=&quot;#一、
    
    </summary>
    
      <category term="高效篇" scheme="http://lyroger.github.io/categories/%E9%AB%98%E6%95%88%E7%AF%87/"/>
    
    
      <category term="runtime" scheme="http://lyroger.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C代码混淆</title>
    <link href="http://lyroger.github.io/2015/12/25/Objective-C%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86/"/>
    <id>http://lyroger.github.io/2015/12/25/Objective-C代码混淆/</id>
    <published>2015-12-25T07:41:00.000Z</published>
    <updated>2016-09-19T08:01:19.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本方法参考CSDN博主 念茜<a href="http://blog.csdn.net/yiyaaixuexi/article/details/29201699" target="_blank" rel="external">iOS安全攻防（二十三）：Objective-C代码混淆</a>,为深度理解，自己按照步骤做了一遍。并写下收获和体会。</p>
<h4 id="一、为什么需要对工程代码进行混淆"><a href="#一、为什么需要对工程代码进行混淆" class="headerlink" title="一、为什么需要对工程代码进行混淆"></a>一、为什么需要对工程代码进行混淆</h4><p>这里我不多说了，可以参考<a href="http://my.csdn.net/yiyaaixuexi" target="_blank" rel="external">念茜</a>的iOS安全攻防系列博客。</p>
<h4 id="二、混淆代码原理"><a href="#二、混淆代码原理" class="headerlink" title="二、混淆代码原理"></a>二、混淆代码原理</h4><p>操作过程中，我使用的是 #define ,将工程中的类中所有的方法名替换成随机字符串，当然，字符串需保证不是关键字。这里的替换方法是由博主 念茜 写的一段脚本。这里就不贴代码了，可以直接去她的<a href="http://blog.csdn.net/yiyaaixuexi/article/details/29201699" target="_blank" rel="external">iOS安全攻防（二十三）：Objective-C代码混淆</a>博文中参阅。</p>
<h4 id="三、操作步骤"><a href="#三、操作步骤" class="headerlink" title="三、操作步骤"></a>三、操作步骤</h4><p>1.将混淆脚本 confuse.sh 放到工程目录下。<br>2.添加头文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">```objective-c</div><div class="line">#ifdef __OBJC__ </div><div class="line">    //添加混淆作用的头文件（这个文件名是脚本confuse.sh中定义的）  </div><div class="line">    #import &quot;codeObfuscation.h&quot;  </div><div class="line">    ....</div><div class="line">#endif</div></pre></td></tr></table></figure></p>
<p>3.配置 Build Phase，在工程 Build Phase 中添加执行脚本操作，执行 confuse.sh 脚本，如图：<br><img src="/images/48D4E311-9DA2-4A18-A16C-BAF46CAEEE5C.jpg" alt=""><br>4.创建函数名列表 func.list ，写入待混淆的函数名。<br>5.跑起工程。</p>
<h4 id="四、一路走来，遇到的问题"><a href="#四、一路走来，遇到的问题" class="headerlink" title="四、一路走来，遇到的问题"></a>四、一路走来，遇到的问题</h4><ol>
<li><code>confuse.sh: No such file or directory</code><br>解决办法：先看看你Build Phases中的Run Script中写的路径是否跟你confuse.sh的路径一致。</li>
<li><code>confuse.sh: Permission denied</code><br>解决办法:chmod a+x confuse.sh  //对confuse.sh文件增加可执行权限</li>
<li><code>func.list: No such file or directory</code><br>解决办法:确保func.list文件与confuse.sh文件在同一个文件夹里面，然后修改<code>念茜</code>的脚本文件：<code>STRING_SYMBOL_FILE=&quot;func.list&quot;</code>为<code>STRING_SYMBOL_FILE=&quot;$PROJECT_DIR/$PROJECT_NAME/func.list&quot;</code>，其实就是改为相对路径，注意这个路径是否对应你的func.list文件路径。</li>
</ol>
<h4 id="五、享受一下成果"><a href="#五、享受一下成果" class="headerlink" title="五、享受一下成果"></a>五、享受一下成果</h4><p>1.首先我func.list中写的要混淆的函数名如下图:<br><img src="/images/0A2DD61D-5C75-4F36-B7A5-A01A14D75040.jpg" alt=""><br>2.使用class-dump查看分析app头文件<br>class-dump命令:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span>-<span class="title">dump</span> -<span class="title">H</span> ....<span class="title">demo</span>.<span class="title">app</span> -<span class="title">o</span> ..../<span class="title">dump</span>-<span class="title">head</span></span></div></pre></td></tr></table></figure></p>
<p>-H后面是app文件路径，-o后面导出头文件的文件夹<br>导出头文件后，查找func.list中替换的类中的函数名如下图:<br><img src="/images/DEF7F821-515F-467E-B1EE-1123F1CC2F4B.jpg" alt=""><br>这样下来，就算拿到分析出头文件，也不太好判断方法是干什么用的。从而又一步提高了app的安全性。</p>
<h4 id="六、建议"><a href="#六、建议" class="headerlink" title="六、建议"></a>六、建议</h4><p>如果一个是一个庞端的工程，我想大家都会觉得，自己还需要一个一个将方法名列入到func.list文件中，这可不是一个小的工作量，这里我看到有人优化了这个操作(<a href="http://blog.csdn.net/yxh265/article/details/38438959" target="_blank" rel="external">详见</a>)，无需自己亲手去填充func.list文件，自动将工程中的所有.m对应的.h文件的函数名导入到func.list，确实是个不做的做法，但我在使用过程中，跑到到自动导入的那段代码，总会遇到奔溃。还望作者能多测试一下。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;本方法参考CSDN博主 念茜&lt;a href=&quot;http://blog.csdn.net/yiyaaixuexi/article/detail
    
    </summary>
    
      <category term="高效篇" scheme="http://lyroger.github.io/categories/%E9%AB%98%E6%95%88%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>FMDB使用SQLCipher加密</title>
    <link href="http://lyroger.github.io/2015/12/23/FMDB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%A0%E5%AF%86/"/>
    <id>http://lyroger.github.io/2015/12/23/FMDB数据库加密/</id>
    <published>2015-12-23T09:33:00.000Z</published>
    <updated>2016-09-19T03:43:31.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>数据库数据加密的必要性就不多说了，直接进入主题，如何使用FMDB对数据加密。<br>这里我建议使用cocospod来管理第三方库，如果没有安装可以参考<a href="http://blog.devtang.com/blog/2014/05/25/use-cocoapod-to-manage-ios-lib-dependency/" target="_blank" rel="external">这里</a>来安装.</p>
<h4 id="1-首先，我们的下载SQLCipher依赖库"><a href="#1-首先，我们的下载SQLCipher依赖库" class="headerlink" title="1.首先，我们的下载SQLCipher依赖库"></a>1.首先，我们的下载SQLCipher依赖库</h4><p>1.1 <figure class="highlight plain"><figcaption><span>'SQLCipher', '~> 3.1.0'```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#### 2.其次，我们需要一个具有加密功能的FMDB版本；</div><div class="line">加密的FMDB其实是一个分支，也就是说，如果你的FMDB版本不支持SQLCipher加密，那么你就需要替换FMDB。Github上关于该分支的安装只提供了cocospod的安装方式。Github上FMDB的[地址](https://github.com/ccgus/fmdb);</div><div class="line">使用cocospod来跟新具有加密功能的FMDB</div><div class="line">2.1 将以前```pod &apos;FMDB&apos;``` 改成```pod &apos;FMDB/SQLCipher&apos;</div></pre></td></tr></table></figure></p>
<p>2.2 更新pod <code>pod update</code></p>
<h4 id="3-最后，修改一下你的代码"><a href="#3-最后，修改一下你的代码" class="headerlink" title="3.最后，修改一下你的代码"></a>3.最后，修改一下你的代码</h4><p>定义一个加密的key,这里我自定义了一个宏<code>DB_SECRETKEY</code>,然后在FMDB中的FMDatabase.m类中加一句代码，如下图:<br><img src="/images/F0547994-4A8E-43A8-A937-DC94A4637CA2.png" alt=""></p>
<h4 id="4-效果"><a href="#4-效果" class="headerlink" title="4.效果"></a>4.效果</h4><p>run下你的工程，并对数据库做一些操作，然后在使用其他管理工具打开数据时，你就发现他会提示你file is encrypted or is not a database<br><img src="/images/AFB7BECA-A6FF-4CE4-BAA1-99097EFAD5BF.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;数据库数据加密的必要性就不多说了，直接进入主题，如何使用FMDB对数据加密。&lt;br&gt;这里我建议使用cocospod来管理第三方库，如果没有安
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>swift学习笔记（基础篇）</title>
    <link href="http://lyroger.github.io/2015/12/14/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9F%BA%E7%A1%80%E7%AF%87%EF%BC%89/"/>
    <id>http://lyroger.github.io/2015/12/14/swift学习笔记（基础篇）/</id>
    <published>2015-12-14T06:35:00.000Z</published>
    <updated>2016-09-19T07:57:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>####一数值型字面量</p>
<ul>
<li>一个十进制数，没有前缀</li>
<li>一个二进制数，前缀是0b</li>
<li>一个八进制数，前缀是0o</li>
<li>一个十六进制数，前缀是0x</li>
</ul>
<p>列如：下面的所有整数字面量的十进制值都是17</p>
<blockquote>
<p>let decimalInteger = 17<br>let binaryInteger = 0b10001       // 二进制的17<br>let octalInteger = 0o21           // 八进制的17<br>let hexadecimalInteger = 0x11     // 十六进制的17</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;####一数值型字面量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一个十进制数，没有前缀&lt;/li&gt;
&lt;li&gt;一个二进制数，前缀是0b&lt;/li&gt;
&lt;li&gt;一个八进制数，前缀是0o&lt;/li&gt;
&lt;li&gt;一个十六进制数，前缀是0x&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;列如：下面的所有整数字面量的十进制值都
    
    </summary>
    
      <category term="swift" scheme="http://lyroger.github.io/categories/swift/"/>
    
    
  </entry>
  
  <entry>
    <title>升级XCode7和iOS9相关问题</title>
    <link href="http://lyroger.github.io/2015/10/22/%E5%8D%87%E7%BA%A7XCode7%E5%92%8CiOS9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
    <id>http://lyroger.github.io/2015/10/22/升级XCode7和iOS9相关问题/</id>
    <published>2015-10-22T06:29:00.000Z</published>
    <updated>2016-09-19T03:43:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-报Bitcode相关错误。"><a href="#一-报Bitcode相关错误。" class="headerlink" title="一.报Bitcode相关错误。"></a>一.报Bitcode相关错误。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Framework/libraries/extends/QQSDK/TencentOpenAPI.framework/TencentOpenAPI(WeiyunAPI.o)&apos; does not contain bitcode. You must rebuild it with bitcode enabled (Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, or disable bitcode for this target. for architecture arm64</div><div class="line">clang: error: linker command failed with exit code 1 (use -v to see invocation)</div></pre></td></tr></table></figure>
<p>1.解决方案<br>工程文件中找到target-&gt;Build Settings-&gt;搜索bitcode，然后出现Enablecode选项，设置为NO即可。如图：</p>
<p><img src="/images/code.jpg" alt=""><br>重新build即可消除bitcode相关问题。</p>
<p>2.问题出现原因可以参考：<a href="http://www.cocoachina.com/ios/20150818/13078.html" title="理解Bitcode：一种中间代码" target="_blank" rel="external">理解Bitcode：一种中间代码</a></p>
<h2 id="二-iOS9设备网络请求失败"><a href="#二-iOS9设备网络请求失败" class="headerlink" title="二.iOS9设备网络请求失败"></a>二.iOS9设备网络请求失败</h2><p>1.出现问题原因<br>iOS9把所有的http请求都改为https了：iOS9系统发送的网络请求将统一使用TLS 1.2 SSL。采用TLS 1.2 协议，目的是:强制增强数据访问安全，而且，系统 Foundation 框架下的相关网络请求，将不再默认使用 Http 等不安全的网络协议，而默认采用 TLS 1.2。服务器因此需要更新，以解析相关数据。如不更新，可通过在 Info.plist 中声明。<br>2.具体如何在info.plist中声明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</div><div class="line">&lt;dict&gt;</div><div class="line">    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</div><div class="line">    &lt;true/&gt;</div><div class="line">&lt;/dict&gt;</div></pre></td></tr></table></figure></p>
<p>如图所示:</p>
<p><img src="/images/plist.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一-报Bitcode相关错误。&quot;&gt;&lt;a href=&quot;#一-报Bitcode相关错误。&quot; class=&quot;headerlink&quot; title=&quot;一.报Bitcode相关错误。&quot;&gt;&lt;/a&gt;一.报Bitcode相关错误。&lt;/h2&gt;&lt;figure class=&quot;highli
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>动画学习篇一</title>
    <link href="http://lyroger.github.io/2015/10/16/%E5%8A%A8%E7%94%BB%E5%AD%A6%E4%B9%A0%E7%AF%87%E4%B8%80/"/>
    <id>http://lyroger.github.io/2015/10/16/动画学习篇一/</id>
    <published>2015-10-16T03:06:00.000Z</published>
    <updated>2016-09-19T07:54:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  最近玩手游比较多，看到了GameCenter中个人中心有一些气泡效果特别好，于是想想怎么实现的，要是能放到自己写的程序中，也是一种不错的感觉，能感觉到应用有一种活力.</p>
<h2 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h2><p>先看看gamecenter中的效果是怎样的，然后我们在着步分析：</p>
<p><img src="/images/gameCenter1.gif" alt=""><br>我们先参考单个气泡效果，就拿GameCenter气泡来说吧，仔细看看，他有一个整体画圈的效果，还有一个一张一缩的动画，想到多个动画组合成的一个效果就可以想到动画帧来做：CAKeyframeAnimation；<br>首先我们来实现一个画圈的效果，看看下面代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">CAKeyframeAnimation *pathAnimation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</div><div class="line">    pathAnimation.calculationMode = kCAAnimationPaced;</div><div class="line">    pathAnimation.fillMode = kCAFillModeForwards;</div><div class="line">    pathAnimation.removedOnCompletion = NO;</div><div class="line">    pathAnimation.repeatCount = INFINITY;</div><div class="line">    pathAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];</div><div class="line">    pathAnimation.duration = 6.0;</div><div class="line">    </div><div class="line">    CGMutablePathRef curvedPath = CGPathCreateMutable();</div><div class="line">    CGFloat amplitude = 10;</div><div class="line">    CGRect circleContainer = CGRectInset(gameView.frame, gameView.bounds.size.width / 2 - amplitude, gameView.bounds.size.width / 2 - amplitude);</div><div class="line">    CGPathAddEllipseInRect(curvedPath, NULL, circleContainer);</div><div class="line">    </div><div class="line">    pathAnimation.path = curvedPath;</div><div class="line">    CGPathRelease(curvedPath);</div><div class="line">    [gameView.layer addAnimation:pathAnimation forKey:@&quot;gameCenterAnimation&quot;];</div></pre></td></tr></table></figure></p>
<p>代码实现效果如下图：</p>
<p><img src="/images/game1.gif" alt=""><br>接下来我们来实现一张一缩的效果：<br>代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">CAKeyframeAnimation *scaleX = [CAKeyframeAnimation animationWithKeyPath:@&quot;transform.scale.x&quot;];</div><div class="line">    scaleX.duration = 1;</div><div class="line">    scaleX.values = @[@1.0, @1.1, @1.0];</div><div class="line">    scaleX.keyTimes = @[@0.0, @0.5, @1.0];</div><div class="line">    scaleX.repeatCount = INFINITY;</div><div class="line">    scaleX.autoreverses = YES;</div><div class="line">    </div><div class="line">    scaleX.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">    [gameView.layer addAnimation:scaleX forKey:@&quot;scaleX&quot;];</div><div class="line">    </div><div class="line">    </div><div class="line">    CAKeyframeAnimation *scaleY = [CAKeyframeAnimation animationWithKeyPath:@&quot;transform.scale.y&quot;];</div><div class="line">    scaleY.duration = 1.5;</div><div class="line">    scaleY.values = @[@1.0, @1.1, @1.0];</div><div class="line">    scaleY.keyTimes = @[@0.0, @0.5, @1.0];</div><div class="line">    scaleY.repeatCount = INFINITY;</div><div class="line">    scaleY.autoreverses = YES;</div><div class="line">    scaleX.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">    [gameView.layer addAnimation:scaleY forKey:@&quot;scaleY&quot;];</div></pre></td></tr></table></figure></p>
<p>结合上面的代码一起，便可以看到整体效果：</p>
<p><img src="/images/game2.gif" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>很多动画其实就是由多个动画分解组合而成，所以要学会使用CAKeyframeAnimation。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;  最近玩手游比较多，看到了GameCenter中个人中心有一些气泡效果特别好，于是想想怎么实现的，要是能放到自己写的程序中，也是一种不错的
    
    </summary>
    
      <category term="动画" scheme="http://lyroger.github.io/categories/%E5%8A%A8%E7%94%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>UISearchBar的使用</title>
    <link href="http://lyroger.github.io/2015/10/14/UISearchBar%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://lyroger.github.io/2015/10/14/UISearchBar的使用/</id>
    <published>2015-10-14T05:18:00.000Z</published>
    <updated>2016-09-19T08:00:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在项目中写搜索比较多，然而UI设计对页面的效果和布局都有所严谨，发布测试版本后设计或多或少会拿着app跑到面前来说这些差那些，作为开发人员，这些都习以为常了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">简介的介绍一下，此文主要想要介绍的内容：在搜索框激活时，出现的并不是遮罩层，而是想利用遮罩层做些其他事情，比如提示语、历史搜索记录等需求。</div></pre></td></tr></table></figure>
<p>为达到此功能，我使用了两个控件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. UISearchBar</div><div class="line">2. UISearchDisplayController</div></pre></td></tr></table></figure>
<p>然而使用这两个控件的原始效果我们可以看看iPhone手机短信或通讯录中的搜索效果，我截了一张短信搜索图,如下图：<br><img src="/images/iOS自带效果.png" alt=""></p>
<p>搜索框激活的时候自带了一层遮罩的效果，但很多时候，设计需求是有各式各样的变化的，可能你不需要这层遮罩层，而是想利用这个空间来做其他的用途，比如一旦搜索框激活，在遮罩层处，我想把这个空间用来做提示，或做历史搜索记录等需求，我们先来看看微信的搜索是怎么样的吧！</p>
<p><img src="/images/微信效果.png" alt=""><br>这个效果不错吧，充分利用了空间，将遮罩层替换成了提示语，“搜索更多内容”，点击提示还是会让UISearchBar失去激活效果，虽然不知道微信是否是使用了UISearchBar和UISearchDisplayController来达到此效果的，但使用这两个控件肯定能实现这个效果。</p>
<h2 id="先来了解UISearchBar"><a href="#先来了解UISearchBar" class="headerlink" title="先来了解UISearchBar"></a>先来了解UISearchBar</h2><p>UISearchBar主要是用来输入搜索词，系统提供的UISearchBar自定义的方式并不是很友好，扩展性并不理想，想要充分了解UISearchBar，我们先来看看UISearchBar的堆栈结构吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(lldb) po [mySearchBar recursiveDescription]</div><div class="line">&lt;UISearchBar: 0x13f518bc0; frame = (0 0; 320 40); text = &apos;&apos;; gestureRecognizers = &lt;NSArray: 0x17005cfb0&gt;; layer = &lt;CALayer: 0x1700297e0&gt;&gt;</div><div class="line">   | &lt;UIView: 0x17018db60; frame = (0 0; 320 40); clipsToBounds = YES; autoresize = W+H; layer = &lt;CALayer: 0x170034560&gt;&gt;</div><div class="line">   |    | &lt;UISearchBarBackground: 0x13f611e10; frame = (0 0; 320 40); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x178039920&gt;&gt;</div><div class="line">   |    | &lt;UISearchBarTextField: 0x13f51a170; frame = (0 0; 0 0); text = &apos;&apos;; clipsToBounds = YES; opaque = NO; layer = &lt;CALayer: 0x170034620&gt;&gt;</div><div class="line">   |    |    | &lt;_UISearchBarSearchFieldBackgroundView: 0x13f612fa0; frame = (0 0; 0 0); opaque = NO; autoresize = W+H; userInteractionEnabled = NO; layer = &lt;CALayer: 0x178037fc0&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>我们打印出UISearchBar的堆栈结构后，我们可以清晰的看出它是由一个UIView组成，这个UIView下又有一个UISearchBarBackground和一个UISearchBarTextField，UISearchBarTextField下还有一个_UISearchBarSearchFieldBackgroundView。这些UIView并没有被UISearchBar   提供，所以你想自定义UISearchBar就得从这些视图入手，下面我修改了UISearchBarTextField的背景色，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mySearchBar = [[UISearchBar alloc] initWithFrame:CGRectMake(0, 0, mScreenWidth, 40)];</div><div class="line">    mySearchBar.delegate = self;</div><div class="line">    mySearchBar.barTintColor = [UIColor whiteColor];</div><div class="line">    [mySearchBar setPlaceholder:@&quot;搜索&quot;];</div><div class="line">    UIColor *bgColor = [UIColor colorWithRed:0xff green:0xff blue:0xff alpha:1];</div><div class="line">    mySearchBar.backgroundImage = [self imageFromColor:bgColor frame:mySearchBar.bounds];</div><div class="line">    for (UIView *subView in mySearchBar.subviews)</div><div class="line">    &#123;</div><div class="line">        for (UIView *secondLevelSubview in subView.subviews)&#123;</div><div class="line">            if ([secondLevelSubview isKindOfClass:[UITextField class]])</div><div class="line">            &#123;</div><div class="line">                UITextField *searchBarTextField = (UITextField *)secondLevelSubview;                searchBarTextField.backgroundColor = GreyishWhiteColor;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>在for循环里 我找到了UISearchBarTextField，并改变了他的背景色。这里不是这篇文章主要讲解的，自定义UISearchBar就不过多讲了。</p>
<h2 id="我们再来了解下UISearchDisplayController"><a href="#我们再来了解下UISearchDisplayController" class="headerlink" title="我们再来了解下UISearchDisplayController"></a>我们再来了解下UISearchDisplayController</h2><p>只有在激活的情况下，UISearchDisplayController才会显示出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">searchDisplayController = [[UISearchDisplayController alloc] initWithSearchBar:mySearchBar contentsController:self];</div><div class="line">    searchDisplayController.searchResultsDataSource = self;</div><div class="line">    searchDisplayController.searchResultsDelegate = self;</div><div class="line">    searchDisplayController.delegate = self;</div></pre></td></tr></table></figure></p>
<p>在这里先初始化controller,初始化的时候注意了，将先前初始化的UISearchBar作为初始化参数穿进去了，这个时候其实就把UISearchBar和UISearchDisplayController关联起来了。搜索激活时，我们将会看到上面提到的遮罩层，其实这就是UISearchDisplayController下面的_UISearchDisplayControllerDimmingView,为什么这么说呢，我们用老方法吧，使用recursiveDescription 把堆栈结构打印出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">po [searchDisplayController recursiveDescription]</div><div class="line">error: Execution was interrupted, reason: Attempted to dereference an invalid ObjC Object or send it an unrecognized selector.</div><div class="line">The process has been returned to the state before expression evaluation.</div></pre></td></tr></table></figure>
<p>发现他并不是UIView的子类，我们跟进去查看一下，原来是继承NSObject的，那他的所呈现的UIView是放在什么视图上面的呢，我们看看他的属性，发现还有一个searchContentsController，那么我们把searchContentsController堆栈打印出来看看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">(lldb) po [controller.searchContentsController.view recursiveDescription]</div><div class="line">&lt;UIView: 0x1781971b0; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x178228fa0&gt;&gt;</div><div class="line">   | &lt;UITableView: 0x14c867a00; frame = (0 0; 320 454); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x17805d190&gt;; animations = &#123; bounds.origin=&lt;CABasicAnimation: 0x17022e1c0&gt;; bounds.size=&lt;CABasicAnimation: 0x17022e220&gt;; &#125;; layer = &lt;CALayer: 0x17803c380&gt;; contentOffset: &#123;0, -20&#125;; contentSize: &#123;320, 478&#125;&gt;</div><div class="line">   |    | &lt;UIView: 0x178197760; frame = (0 -0.5; 320 0.5); hidden = YES; autoresize = W; layer = &lt;CALayer: 0x17822a3a0&gt;&gt;</div><div class="line">   |    | &lt;UITableViewWrapperView: 0x14c5137c0; frame = (0 0; 320 454); gestureRecognizers = &lt;NSArray: 0x17805d3d0&gt;; layer = &lt;CALayer: 0x17822a2c0&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;320, 454&#125;&gt;</div><div class="line">   |    | &lt;UISearchBar: 0x14c514cc0; frame = (0 0; 320 44); text = &apos;&apos;; gestureRecognizers = &lt;NSArray: 0x17805cf50&gt;; layer = &lt;CALayer: 0x17822a000&gt;&gt;</div><div class="line">   |    |    | &lt;UIView: 0x1781975c0; frame = (0 0; 320 44); autoresize = W+H; layer = &lt;CALayer: 0x17822a0c0&gt;&gt;</div><div class="line">   |    |    |    | &lt;UISearchBarBackground: 0x14c5122b0; frame = (0 -20; 320 64); opaque = NO; userInteractionEnabled = NO; animations = &#123; position=&lt;CABasicAnimation: 0x17022f140&gt;; bounds.origin=&lt;CABasicAnimation: 0x17022f380&gt;; bounds.size=&lt;CABasicAnimation: 0x17022f3e0&gt;; contentsCenter=&lt;CABasicAnimation: 0x17022f4c0&gt;; &#125;; layer = &lt;CALayer: 0x17822a160&gt;&gt;</div><div class="line">   |    |    |    | &lt;UISearchBarTextField: 0x14c518b40; frame = (8 8; 239 28); text = &apos;&apos;; clipsToBounds = YES; opaque = NO; gestureRecognizers = &lt;NSArray: 0x17805d970&gt;; animations = &#123; position=&lt;CABasicAnimation: 0x17022f560&gt;; bounds.origin=&lt;CABasicAnimation: 0x17022f6a0&gt;; bounds.size=&lt;CABasicAnimation: 0x17022f700&gt;; &#125;; layer = &lt;CALayer: 0x17003e500&gt;&gt;</div><div class="line">   |    |    |    |    | &lt;_UISearchBarSearchFieldBackgroundView: 0x14c617ff0; frame = (0 0; 239 28); opaque = NO; autoresize = W+H; userInteractionEnabled = NO; animations = &#123; position=&lt;CABasicAnimation: 0x17022f740&gt;; bounds.origin=&lt;CABasicAnimation: 0x17822bea0&gt;; bounds.size=&lt;CABasicAnimation: 0x17822bda0&gt;; &#125;; layer = &lt;CALayer: 0x170225de0&gt;&gt;</div><div class="line">   |    |    |    |    | &lt;UISearchBarTextFieldLabel: 0x14c618950; frame = (29 1; 203 25); text = &apos;搜索&apos;; opaque = NO; userInteractionEnabled = NO; animations = &#123; position=&lt;CABasicAnimation: 0x17822c560&gt;; bounds.origin=&lt;CABasicAnimation: 0x17822c6a0&gt;; bounds.size=&lt;CABasicAnimation: 0x17822c700&gt;; &#125;; layer = &lt;_UILabelLayer: 0x170087f80&gt;&gt;</div><div class="line">   |    |    |    |    |    | &lt;_UILabelContentLayer: 0x17822b240&gt; (layer)</div><div class="line">   |    |    |    |    | &lt;UIFieldEditor: 0x14c522e10; frame = (28 2; 204 24); text = &apos;&apos;; clipsToBounds = YES; opaque = NO; gestureRecognizers = &lt;NSArray: 0x17805a3d0&gt;; layer = &lt;CALayer: 0x1782285e0&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;204, 24&#125;&gt;</div><div class="line">   |    |    |    |    |    | &lt;_UIFieldEditorContentView: 0x1781981f0; frame = (0 0; 204 24); opaque = NO; userInteractionEnabled = NO; gestureRecognizers = &lt;NSArray: 0x1702441d0&gt;; layer = &lt;CALayer: 0x178227d40&gt;&gt;</div><div class="line">   |    |    |    |    |    |    | &lt;UITextSelectionView: 0x14c50e2d0; frame = (0 0; 0 0); userInteractionEnabled = NO; layer = &lt;CALayer: 0x178227aa0&gt;&gt;</div><div class="line">   |    |    |    |    |    | &lt;UIImageView: 0x1701ef500; frame = (200.5 12; 3.5 12); alpha = 0; opaque = NO; autoresize = LM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x17022f900&gt;&gt;</div><div class="line">   |    |    |    |    |    | &lt;UIImageView: 0x1781ef200; frame = (197 20.5; 7 3.5); alpha = 0; opaque = NO; autoresize = TM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x17822ca60&gt;&gt;</div><div class="line">   |    |    |    |    | &lt;UIImageView: 0x1701ee700; frame = (8 7.5; 13 13); opaque = NO; userInteractionEnabled = NO; animations = &#123; position=&lt;CABasicAnimation: 0x17822c0e0&gt;; &#125;; layer = &lt;CALayer: 0x17022a3c0&gt;&gt;</div><div class="line">   |    |    |    | &lt;UINavigationButton: 0x14c615af0; frame = (258 6; 54 30); opaque = NO; animations = &#123; position=&lt;CABasicAnimation: 0x17822bc60&gt;; opacity=&lt;CABasicAnimation: 0x17822bf60&gt;; &#125;; layer = &lt;CALayer: 0x17003d180&gt;&gt;</div><div class="line">   |    |    |    |    | &lt;UIButtonLabel: 0x14c60e1a0; frame = (0 4; 53.5 20.5); text = &apos;Cancel&apos;; opaque = NO; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x170087da0&gt;&gt;</div><div class="line">   |    | &lt;UIView: 0x170198600; frame = (0 44; 320 0); animations = &#123; position=&lt;CABasicAnimation: 0x17022e180&gt;; &#125;; layer = &lt;CALayer: 0x17022aa00&gt;&gt;</div><div class="line">   | &lt;UISearchDisplayControllerContainerView: 0x1701efe00; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x17022d620&gt;&gt;</div><div class="line">   |    | &lt;UIView: 0x170196e70; frame = (0 0; 320 568); layer = &lt;CALayer: 0x17022d800&gt;&gt;</div><div class="line">   |    |    | &lt;UISearchResultsTableView: 0x14d046200; frame = (0 0; 320 568); clipsToBounds = YES; hidden = YES; autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x170240450&gt;; layer = &lt;CALayer: 0x17022aa20&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;320, 44&#125;&gt;</div><div class="line">   |    |    |    | &lt;UITableViewWrapperView: 0x14c6198f0; frame = (0 0; 320 568); gestureRecognizers = &lt;NSArray: 0x170240690&gt;; layer = &lt;CALayer: 0x17022ab00&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;320, 568&#125;&gt;</div><div class="line">   |    |    |    |    | &lt;UITableViewCell: 0x14c60fe10; frame = (0 0; 320 44); text = &apos;搜索第一行&apos;; autoresize = W; layer = &lt;CALayer: 0x170225ac0&gt;&gt;</div><div class="line">   |    |    |    |    |    | &lt;UITableViewCellContentView: 0x178196b30; frame = (0 0; 320 43.5); gestureRecognizers = &lt;NSArray: 0x17805a760&gt;; layer = &lt;CALayer: 0x17803a680&gt;&gt;</div><div class="line">   |    |    |    |    |    |    | &lt;UITableViewLabel: 0x14c5049b0; frame = (15 0; 290 43.5); text = &apos;搜索第一行&apos;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x178084f10&gt;&gt;</div><div class="line">   |    |    |    |    |    |    |    | &lt;_UILabelContentLayer: 0x17003e820&gt; (layer)</div><div class="line">   |    |    |    |    |    | &lt;_UITableViewCellSeparatorView: 0x1781c3840; frame = (15 43.5; 305 0.5); layer = &lt;CALayer: 0x17822bb20&gt;&gt;</div><div class="line">   |    |    |    | &lt;UIImageView: 0x1701f0800; frame = (0 564.5; 320 3.5); alpha = 0; opaque = NO; autoresize = TM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x17022e6a0&gt;&gt;</div><div class="line">   |    |    |    | &lt;UIImageView: 0x1701f0900; frame = (316.5 524; 3.5 44); alpha = 0; opaque = NO; autoresize = LM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x17022e880&gt;&gt;</div><div class="line">   |    | &lt;UIView: 0x170197eb0; frame = (0 20; 320 44); animations = &#123; position=&lt;CABasicAnimation: 0x17022f0c0&gt;; &#125;; layer = &lt;CALayer: 0x17022d7c0&gt;&gt;</div><div class="line">   |    | &lt;UIView: 0x170197f80; frame = (0 64; 320 504); animations = &#123; bounds.origin=&lt;CABasicAnimation: 0x17022f100&gt;; bounds.size=&lt;CABasicAnimation: 0x17022f160&gt;; position=&lt;CABasicAnimation: 0x17022f220&gt;; &#125;; layer = &lt;CALayer: 0x17022d7e0&gt;&gt;</div><div class="line">   |    |    | &lt;_UISearchDisplayControllerDimmingView: 0x1701c3840; frame = (0 0; 320 504); alpha = 0.4; opaque = NO; autoresize = W+H; animations = &#123; position=&lt;CABasicAnimation: 0x17022f1a0&gt;; bounds.origin=&lt;CABasicAnimation: 0x17022f2c0&gt;; bounds.size=&lt;CABasicAnimation: 0x17022f320&gt;; opacity=&lt;CABasicAnimation: 0x17822c8c0&gt;; &#125;; layer = &lt;CALayer: 0x17022df60&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>打印出来的东西有点多，不要着急，要了解清楚这里面的结构还需要耐心和细心，我们先找到UISearchDisplayControllerContainerView，这个view下面有三个子view，其中一个子view中加载着UISearchResultsTableView，这个UISearchResultsTableView是估计大家都很熟悉吧，搜索出来的数据就是加载到这个UISearchResultsTableView上的，然后我们再仔细看看，三个子view中还有一个view下加载着_UISearchDisplayControllerDimmingView，我们试图在这个view上加一些东西，看看会有什么变化,我这里把预先初始化好了的提示页面加载到这个view上，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (void)addTipsViewWithController：(UISearchDisplayController*)controller</div><div class="line">&#123;</div><div class="line">    UIView *supV = controller.searchResultsTableView.superview;</div><div class="line">    UIView *supsupV = supV.superview;</div><div class="line">    for (UIView *view in supsupV.subviews) &#123;</div><div class="line">        for (UIView *sencondView in view.subviews) &#123;</div><div class="line">            if ([sencondView isKindOfClass:[NSClassFromString(@&quot;_UISearchDisplayControllerDimmingView&quot;) class]]) &#123;</div><div class="line">                NSLog(@&quot;_UISearchDisplayControllerDimmingView&quot;);</div><div class="line">                if (![sencondView viewWithTag:99]) &#123;</div><div class="line">                    [sencondView addSubview:self.tempSearchDisplayBackgroungView];</div><div class="line">                &#125;</div><div class="line">                sencondView.alpha = 1;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或许你的 NSLog(@”_UISearchDisplayControllerDimmingView”);日志重来就没打印出来，不用着急，你可以延时加载此view<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)searchDisplayControllerWillBeginSearch:(UISearchDisplayController *)controller</div><div class="line">&#123;</div><div class="line">    [self performSelector:@selector(addTipsViewWithView:) withObject:controller afterDelay:0.1];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样就没问题了。然后我们来看看效果，是不是发现阴影层上有了我们自己加的页面呢？我们再修改下自己定义的提示页面，设置frame的大小为阴影层的大小，放在阴影层上，但每次都需要将阴影层的alpha设为1，如果每次设置，第二次以及后面搜索时，你加载的提示页面讲是透明的。最后来看看我的效果见下图：</p>
<p><img src="/images/最终效果.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>遇到一些扩展性不是很强，或者布局复杂都不要着急，一定要静下心来慢慢查看，熟悉使用UIView的recursiveDescription，强调一定是UIView对象，如果觉得recursiveDescription打印出来的不够直观，推荐使用工具Reveal工具，不过他不是免费的哦。这款软件能直观立体的将试图展示出来，很快的定位试图结构。如有需要该文中提到的相关工程，可以到[这里][mark_SearchBar]下载。还有其他更好的方法，也希望大家多多交流。祝好！</p>
<h2 id="mark-SearchBar-https-github-com-lyroger-SearchBarPro-SearchBarPro"><a href="#mark-SearchBar-https-github-com-lyroger-SearchBarPro-SearchBarPro" class="headerlink" title="[mark_SearchBar]: https://github.com/lyroger/SearchBarPro (SearchBarPro)"></a>[mark_SearchBar]: <a href="https://github.com/lyroger/SearchBarPro" target="_blank" rel="external">https://github.com/lyroger/SearchBarPro</a> (SearchBarPro)</h2><p>关注我的「lyroger」微信公众号：</p>
<p><img src="/images/qrcode_for_gh_6f53ca8d5aea_258.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在项目中写搜索比较多，然而UI设计对页面的效果和布局都有所严谨，发布测试版本后设计或多或少会拿着app跑到面前来说这些差那些，作为开发人员，这些都习以为常了。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td clas
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>Markdown学习</title>
    <link href="http://lyroger.github.io/2015/10/14/Markdown%E5%AD%A6%E4%B9%A0/"/>
    <id>http://lyroger.github.io/2015/10/14/Markdown学习/</id>
    <published>2015-10-14T05:16:00.000Z</published>
    <updated>2016-09-19T08:00:04.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-标题"><a href="#一-标题" class="headerlink" title="一.标题"></a>一.标题</h2><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6><h2 id="二-无序列表"><a href="#二-无序列表" class="headerlink" title="二.无序列表"></a>二.无序列表</h2><ul>
<li>我的</li>
<li>你的</li>
<li>他的</li>
</ul>
<h2 id="三-有序列表"><a href="#三-有序列表" class="headerlink" title="三.有序列表"></a>三.有序列表</h2><ol>
<li>我的</li>
<li>你的</li>
<li>她的</li>
</ol>
<h2 id="四-引用"><a href="#四-引用" class="headerlink" title="四.引用"></a>四.引用</h2><blockquote>
<p>这里是引用</p>
</blockquote>
<h2 id="五-图片与链接"><a href="#五-图片与链接" class="headerlink" title="五.图片与链接"></a>五.图片与链接</h2><ol>
<li><img src="http://mouapp.com/Mou_128.png" alt="Mou的icon"></li>
<li><a href="http://www.jianshu.com/p/1e402922ee32/" target="_blank" rel="external">Markdown学习链接</a></li>
<li>建议您参考<a href="http://www.jianshu.com/p/1e402922ee32/" title="Markdown——入门指南" target="_blank" rel="external">Markdown——入门指南</a>或者参考<a href="http://wowubuntu.com/markdown/" title="Markdown语法说明(简体中文版)" target="_blank" rel="external">Markdown语法说明(简体中文版)</a></li>
</ol>
<p><img src="/images/jiafei.gif" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">链接内容定义的形式为：</div><div class="line">1.方括号（前面可以选择性地加上至多三个空格来缩进），里面输入链接文字</div><div class="line">接着一个冒号</div><div class="line">接着一个以上的空格或制表符</div><div class="line">接着链接的网址</div><div class="line">选择性地接着 title 内容，可以用单引号、双引号或是括弧包着</div><div class="line">下面这三种链接的定义都是相同：</div><div class="line">1. [foo]: http://example.com/  &quot;Optional Title Here&quot;</div><div class="line">2. [foo]: http://example.com/  &apos;Optional Title Here&apos;</div><div class="line">3. [foo]: http://example.com/  (Optional Title Here)</div><div class="line">请注意：有一个已知的问题是 Markdown.pl 1.0.1 会忽略单引号包起来的链接 title。</div><div class="line">链接网址也可以用尖括号包起来：</div><div class="line">* [id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;</div></pre></td></tr></table></figure>
<h2 id="六-粗体与斜体"><a href="#六-粗体与斜体" class="headerlink" title="六.粗体与斜体"></a>六.粗体与斜体</h2><ol>
<li>这是 <strong>粗体</strong></li>
<li>这是 <em>斜体</em></li>
<li>这是 常态</li>
</ol>
<h2 id="七-表格"><a href="#七-表格" class="headerlink" title="七.表格"></a>七.表格</h2><table>
<thead>
<tr>
<th>name(巨左对齐)</th>
<th style="text-align:center">age(居中对齐)</th>
<th style="text-align:right">sex(居右对齐)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ly</td>
<td style="text-align:center">28</td>
<td style="text-align:right">男</td>
</tr>
</tbody>
</table>
<h2 id="八-代码框"><a href="#八-代码框" class="headerlink" title="八.代码框"></a>八.代码框</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (UIImage *)imageFromColor:(UIColor *)color frame:(CGRect)rect</div><div class="line">&#123;</div><div class="line">    UIGraphicsBeginImageContext(rect.size);</div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line">    CGContextSetFillColorWithColor(context, [color CGColor]);</div><div class="line">    CGContextFillRect(context, rect);</div><div class="line">    UIImage *img = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    return img;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 标题一</div><div class="line">## 标题二</div><div class="line">### 标题三</div></pre></td></tr></table></figure>
<h2 id="九-分割线"><a href="#九-分割线" class="headerlink" title="九.分割线"></a>九.分割线</h2><h2 id=""><a href="#" class="headerlink" title="*"></a><strong><strong><strong><em>*</em></strong></strong></strong></h2><h2 id="十-区域引用"><a href="#十-区域引用" class="headerlink" title="十.区域引用"></a>十.区域引用</h2><blockquote>
<p>This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,<br>consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.<br>Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.</p>
<p>Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse<br>id sem consectetuer libero luctus adipiscing.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一-标题&quot;&gt;&lt;a href=&quot;#一-标题&quot; class=&quot;headerlink&quot; title=&quot;一.标题&quot;&gt;&lt;/a&gt;一.标题&lt;/h2&gt;&lt;h1 id=&quot;一级标题&quot;&gt;&lt;a href=&quot;#一级标题&quot; class=&quot;headerlink&quot; title=&quot;一级标题&quot;&gt;&lt;/a
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>iOS学习笔记</title>
    <link href="http://lyroger.github.io/2015/09/08/iOS/"/>
    <id>http://lyroger.github.io/2015/09/08/iOS/</id>
    <published>2015-09-08T06:18:00.000Z</published>
    <updated>2016-09-19T07:59:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>f## 一.LLDB的使用</p>
<ol>
<li>po: 对一个对象的打印，即“print-object”.</li>
<li>p: 对一个简单类型的打印.</li>
<li>recursiveDescription: UIView私有方法，可以打印更具体更详细的布局结构.比如 :<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">po [view recursiveDescription]</div><div class="line">&lt;UIView: 0x178199640; frame = (0 64; 320 568); userInteractionEnabled = NO; tag = 99; layer = &lt;CALayer: 0x178421480&gt;&gt;</div><div class="line">   | &lt;UILabel: 0x13ce20170; frame = (90 50; 140 23.86); text = &apos;搜索更多的内容&apos;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x17008f190&gt;&gt;</div><div class="line">   | &lt;CALayer: 0x170034e60&gt; (layer)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这样你能更清晰的知道view的布局结构，它下面包含了一个UILabel和一个CALayer。利用这个私有方法，有时候确实能解决一些难题，曾经在做一个搜索功能的时候，遇到一些瓶颈，使用这个方法让我找到了解决问题的地方。在<a href="http://lyboy.farbox.com/post/uisearchbarde-shi-yong" target="_blank" rel="external">这篇文章</a>中有相关提到。<a href="https://github.com/lyroger/SearchBarPro" title="SearchBarPro" target="_blank" rel="external">源代码</a></p>
<h2 id="二-数据库相关"><a href="#二-数据库相关" class="headerlink" title="二.数据库相关"></a>二.数据库相关</h2><ol>
<li>当你有多条数据插入的时候，但又不清楚数据库是否已经存在该记录，怕导致重复添加数据，你首先想到的可能就是先查询一次，然后判断是否存在相同记录，如果不存在则添加，存在则更新。但这样的操作并不适用于数据量稍微多一点的场合，现在有一种方法可以有效的解决这个问题适用,如下代码:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">replace into table (a,b) values (&apos;1&apos;,&apos;2&apos;)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>使用这条sql语句的有效性的前提是table中必须必须有唯一标示 UNIQUE，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS TestTable (&apos;a&apos; VARCHAR PRIMARY KEY NOT NULL UNIQUE, &apos;b&apos; VARCHAR)</div></pre></td></tr></table></figure></p>
<p>定义好a为唯一标示后，上面的replace into 才会起效。<br>如果我的数据中一个字段并不能确定唯一性，那需要加约束；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS TestTable (&apos;a&apos; VARCHAR PRIMARY KEY NOT NULL UNIQUE, &apos;b&apos; VARCHAR,&apos;c&apos;VARCHAR,UNIQUE(b,c) ON CONFLICT REPLACE)</div></pre></td></tr></table></figure></p>
<p>这个时候，如果你插入的数据b，c有跟以前记录中都相同的话，那么他只会做更新操作，并不会做插入操作。这便是replace into 语句的好处。避免重复。</p>
<h2 id="三-Auto-Layout"><a href="#三-Auto-Layout" class="headerlink" title="三.Auto Layout"></a>三.Auto Layout</h2><blockquote>
<p>Auto Layout + UITableView-FDTemplateLayoutCell + Masonry</p>
<h2 id="四-时间差"><a href="#四-时间差" class="headerlink" title="四.时间差"></a>四.时间差</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mach_timebase_info_data_t info;</div><div class="line">if (mach_timebase_info(&amp;info) != KERN_SUCCESS) return -1.0;</div><div class="line">uint64_t start = mach_absolute_time ();</div><div class="line">// 这里写入需要统计时间的执行代码</div><div class="line">// ......</div><div class="line">uint64_t end = mach_absolute_time ();</div><div class="line">uint64_t elapsed = end - start;</div><div class="line">uint64_t nanos = elapsed * info.numer / info.denom;</div><div class="line">return (CGFloat)nanos / NSEC_PER_SEC;</div></pre></td></tr></table></figure>
</blockquote>
<h2 id="五-pod使用提高篇"><a href="#五-pod使用提高篇" class="headerlink" title="五.pod使用提高篇"></a>五.pod使用提高篇</h2><h4 id="pod更新"><a href="#pod更新" class="headerlink" title="pod更新:"></a>pod更新:</h4><p>更新新的依赖库时，使用pod update 命令很多时候都卡在了Analyzing dependencies不动，使用这个命令会升级CocoaPods的spec仓库，所以跟新非常慢，要等很久。<br>在网上搜索解决此方法的命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod update --verbose --no-repo-update</div></pre></td></tr></table></figure></p>
<h4 id="通过vim命令创建文件"><a href="#通过vim命令创建文件" class="headerlink" title="通过vim命令创建文件"></a>通过vim命令创建文件</h4><p>1：cd到相应文件夹<br>2：输入vim Podfile<br>3:这时已经创建了文件，可以在dos中输入文件内容，<br>platform :ios, ‘7.0’<br>pod ‘Masonry’<br>4:按Esc键，然后输入”:”，然后输入”wq”,Podfile文件及内容创建完毕</p>
<h2 id="六-iOS中使用的锁"><a href="#六-iOS中使用的锁" class="headerlink" title="六.iOS中使用的锁"></a>六.iOS中使用的锁</h2><ol>
<li>@synchronized 关键字加锁</li>
<li>NSLock 对象锁</li>
<li>NSCondition</li>
<li>NSConditionLock 条件锁</li>
<li>NSRecursiveLock 递归锁</li>
<li>pthread_mutex 互斥锁（C语言）</li>
<li>dispatch_semaphore 信号量实现加锁（GCD）</li>
<li>OSSpinLock</li>
</ol>
<h2 id="七-UIViewController页面内容适配"><a href="#七-UIViewController页面内容适配" class="headerlink" title="七.UIViewController页面内容适配"></a>七.UIViewController页面内容适配</h2><p>在滚动视图中 设置<br>automaticallyAdjustsScrollViewInsets属性可以控制滚动内容是否会在bar下方显示。</p>
<h2 id="八-使用终端统计项目代码总行数"><a href="#八-使用终端统计项目代码总行数" class="headerlink" title="八.使用终端统计项目代码总行数"></a>八.使用终端统计项目代码总行数</h2><p>1、打开终端<br>2、cd 进入项目根目录<br>3、输入命令 find . “(“ -name “<em>.m” -or -name “</em>.mm” -or -name “<em>.cpp” -or -name “</em>.h” -or -name “*.rss” “)” -print | xargs wc -l<br>4、回车</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;f## 一.LLDB的使用&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;po: 对一个对象的打印，即“print-object”.&lt;/li&gt;
&lt;li&gt;p: 对一个简单类型的打印.&lt;/li&gt;
&lt;li&gt;recursiveDescription: UIView私有方法，可以打印更具体更详细的布局结
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
  <entry>
    <title>关于做ipod library开发的体验</title>
    <link href="http://lyroger.github.io/2013/06/08/%E5%85%B3%E4%BA%8E%E5%81%9Aipod-library%E5%BC%80%E5%8F%91%E7%9A%84%E4%BD%93%E9%AA%8C/"/>
    <id>http://lyroger.github.io/2013/06/08/关于做ipod-library开发的体验/</id>
    <published>2013-06-08T08:56:48.000Z</published>
    <updated>2016-09-19T09:07:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在忙着做一个文件传输的软件，刚开始也没去想项目实现的困难度，可不可行。怎么说呢，因为有类似的软件都已经上线了，别人都已经实现了，就算在可行性上面做再多的分析，也是多余的了。做这个项目也是我换工作后的第一个项目，以前做ios开发时间并不是很长，对ios开发的经验也是有限的。也没想过会遇到什么困难，既来之则安之了吧。</p>
<p>　　项目分下来后，我被安排做音视频模块和图片模块，主要做UI和媒体文件的获取任务和播放。看起来并不是很多事情，我按照以前的工作思维，拿到需求，找到解决方案，考虑工作周期，计划工作量，恭恭敬敬的做起来。一般我的做法都是先把自己没把握的问题先去找个解决方案，要是有了这些方案后，工作起来就不会感觉到压力，就只是工作量的问题了。所以看了需求后，我第一个就是去找怎么获取ipod里面的文件，以及它们的基本属性，比如音乐文件，它们的专辑名称、歌手、封面等。当时在博客园上找到了一篇关于获取ipod音乐文件基本信息的博客，很兴奋的看完了，同时也转载到了自己的博客中，供自己以后随时翻阅，在我的博客中叫<a href="http://www.cnblogs.com/lyanet/archive/2013/03/27/2985019.html" target="_blank" rel="external">《ios获取音乐库信息（转）》</a>，当时看的也不是原文，所以我也不知道原文在哪，就只是在标题上加了个“转”字，以表非自己著作。然后我便按照此篇文章将ipod里的操作都完成了，播放音乐，音乐列表，音乐文件的封面，歌手等。其实仅仅只是做到这些，并不是很难，因为你只需要使用MPMediaQuery就可以获取ipod里的所有音乐文件，然后循环他的item就可以拿到每个音乐文件对象，根据音乐文件对象的valueForProperty：方法可以拿到你想要的东西。小说明一下：并不是你想要的所有都能拿到。正因为这个，我才遇到了些问题，也是我在此项目中遇到最困难最难解决的问题。也开始了解ios系统的基本原理。文章开始就说了，我是要做一个文件传输的软件，所以并不是只将自己程序中的文件传输，既然要提到ipod，也意味着要对ipod里面的文件进行操作，需要播放，传输等。我想：做ios开发的人都知道ios是一个比较封闭的，这也是此系统的高安全性所在。他基于沙盒原理，想要对其他程序的文件进行操作，不是系统给出的接口，你是没办法去实现你想要的需求的。所以当时我一直对ipod文件导出困惑不解，查阅了很多资料，发过很多贴，问过一些同事，但都没能解决问题。所以这个问题也拖了很久。问题不主要在于怎么导出，关键在于导出后还能提供给其他平台的系统使用，比如android系统。这就是文件的格式问题了。因为在ios系统中，提供的接口导出的文件基本上是m4a、caf等的格式。这些格式在android系统上播放不了。所以要想在其他系统中也能播放，也就只能是mp3格式了。想要导出成mp3格式的文件，我想很多人都想要这个需求吧，这是我在很多贴上看到的，但基本上没人能把这个导出成mp3格式的解决方案贴的很详细。后来我能想到的办法就是使用网上说的lame库，首先将ipod里面的文件导出成caf格式的，再通过lame库将其转换成mp3格式的。我试了，成功了，让我兴奋了一把，但导出的结果却不尽人意。有两个最严重的缺点，一个是转换的时间比较长，10M的文件转换花了一分钟，我想：对于一个文件传输的软件是接受不了这个现实的；二就是它转换后音质变底了，文件大小也明显变小了。我想这是mp3格式的问题，mp3本身就是有损的转换。做到这里了，我实在是绝望了，不知道怎么去解决这个问题了。但别的软件有是怎么解决这个问题的呢？我自己都不知道怎么去说服自己，难道别人是自己做的格式转换？还是花了钱给了苹果找了接口直接导出mp3文件？这些困惑我无法证实。突然感觉到绝望了。我也开始转移了注意，着手做了其他项目。也就在做其他项目不久，终于看到希望了，有个同事在网上找到了一个demo，导出mp3文件就在一秒之内解决。很神奇，让我有惊讶有兴奋。没有音质的损失，文件大小基本没变化，但还是丢失了一些基本元素，比如歌曲的封面、歌手等属性。要想做到属性也不丢失，还得自己加上这些属性，我想我们已经做的更好了，能导出mp3文件已经实在是让我很兴奋了。这些小问题也就先不看吧。</p>
<p>　　导出mp3格式的文件了，问题也就解决了。我心情也平复了许多。如果有朋友也有此方面的需求，可以到这里下载<a href="https://github.com/lyroger/TSLibraryImport" target="_blank" rel="external">demo</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在忙着做一个文件传输的软件，刚开始也没去想项目实现的困难度，可不可行。怎么说呢，因为有类似的软件都已经上线了，别人都已经实现了，就算在可行性上面做再多的分析，也是多余的了。做这个项目也是我换工作后的第一个项目，以前做ios开发时间并不是很长，对ios开发的经验也是有限的
    
    </summary>
    
      <category term="基础篇" scheme="http://lyroger.github.io/categories/%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    
    
  </entry>
  
</feed>
